(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function g(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(d){if(d.ep)return;d.ep=!0;const l=g(d);fetch(d.href,l)}})();const P=navigator.userAgent.match(/iPhone|iPad|iPod/i);function L(T){const s=this;this.object=T,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const g=function({alpha:i,beta:h,gamma:b,webkitCompassHeading:M}){if(P){const m=360-M;s.alphaOffset=THREE.MathUtils.degToRad(m-i),s.deviceOrientation={alpha:i,beta:h,gamma:b,webkitCompassHeading:M}}else i<0&&(i+=360),s.deviceOrientation={alpha:i,beta:h,gamma:b};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:T.rotation}}))},r=function(){s.screenOrientation=window.orientation||0},d=(function(){window.addEventListener("orientationchange",r,!1),P?window.addEventListener("deviceorientation",g,!1):window.addEventListener("deviceorientationabsolute",g,!1)}).bind(this),l=function(){const i=new THREE.Vector3(0,0,1),h=new THREE.Euler,b=new THREE.Quaternion,M=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(m,w,v,y,C){h.set(v,w,-y,"YXZ"),m.setFromEuler(h),m.multiply(M),m.multiply(b.setFromAxisAngle(i,-C))}}();this.connect=function(){r(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(i){i=="granted"&&d()}).catch(function(i){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",i)}):d(),s.enabled=!0},this.disconnect=function(){P?(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientation",g,!1)):(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientationabsolute",g,!1)),s.enabled=!1,s.initialOffset=!1,s.deviceOrientation=null},this.update=function({theta:i=0}={theta:0}){if(s.enabled===!1)return;const h=s.deviceOrientation;if(h){const b=h.alpha?THREE.MathUtils.degToRad(h.alpha):0,M=h.beta?THREE.MathUtils.degToRad(h.beta):0,m=h.gamma?THREE.MathUtils.degToRad(h.gamma):0,w=s.screenOrientation?THREE.MathUtils.degToRad(s.screenOrientation):0;if(P){const v=new THREE.Quaternion;l(v,b,M,m,w);const y=new THREE.Euler().setFromQuaternion(v,"YXZ");console.log(y.x,y.y,y.z),y.y=THREE.MathUtils.degToRad(360-h.webkitCompassHeading),v.setFromEuler(y),s.object.quaternion.copy(v)}else l(s.object.quaternion,b+i,M,m,w)}},this.updateAlphaOffset=function(){s.initialOffset=!1},this.dispose=function(){s.disconnect()},this.getAlpha=function(){const{deviceOrientation:i}=s;return i&&i.alpha?THREE.MathUtils.degToRad(i.alpha)+s.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:i}=s;return i&&i.beta?THREE.MathUtils.degToRad(i.beta):0}}L.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:L});window.onload=()=>{let T=!1,s=null;const g={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},d=[3,5.5,12],l=document.querySelector("a-scene"),i=document.querySelector("[gps-new-camera]");i.setAttribute("camera",{far:100});const h=i.getObject3D("camera");new L(h).connect();const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const m=document.createElement("div");m.id="compassContainer",document.body.appendChild(m);const w=document.createElement("div");w.id="compassArrow",w.innerText="↑",m.appendChild(w);const v=document.createElement("div");v.id="compassText",m.appendChild(v),window.addEventListener("camera-rotation-change",e=>{const a=e.detail.cameraRotation;s=new THREE.Quaternion().setFromEuler(a).toArray(),console.log("currentQuaternion: "+s),y(s),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),j(s,r.latitude,r.longitude,g.latitude,g.longitude))}),i.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const a=q(r.latitude,r.longitude,g.latitude,g.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(a)} m`;let n=0;if(document.querySelectorAll("a-sphere").forEach(o=>o.remove()),d.forEach((o,c)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const f=H(r.latitude,r.longitude,g.latitude,g.longitude,o,n);t.setAttribute("gps-new-entity-place",{latitude:f.latitude,longitude:f.longitude});let u;c===0?u=.3:c===1?u=.4:c===2&&(u=.65),t.setAttribute("radius",u.toString()),l.appendChild(t)}),!T){const o=document.createElement("a-image");o.setAttribute("src","./images/map-marker.png"),o.setAttribute("width","4"),o.setAttribute("height","4"),o.setAttribute("look-at","[gps-new-camera]"),o.setAttribute("gps-new-entity-place",{latitude:g.latitude,longitude:g.longitude}),l.appendChild(o),T=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),D("Keine aktuellen Koordinaten vorhanden!")});function y(e){if(!e)return;const a=C(e);w.style.transform=`rotate(${-a}deg)`,v.innerText=`${Math.round(a)}°`}function C(e){let[a,n,o,c]=e,t=Math.atan2(2*(c*o+a*n),1-2*(n*n+o*o))*180/Math.PI;return t<0&&(t+=360),t}function H(e,a,n,o,c,t){const f=I(e,a,n,o,c),u=f.latitude-e,p=f.longitude-a,E=u*Math.cos(t)-p*Math.sin(t),O=u*Math.sin(t)+p*Math.cos(t);return{latitude:e+E,longitude:a+O}}function I(e,a,n,o,c){const t=Math.PI/180,f=(o-a)*t,u=Math.sin(f)*Math.cos(n*t),p=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(f),E=Math.atan2(u,p),O=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(c/O)+Math.cos(e*t)*Math.sin(c/O)*Math.cos(E)),R=a*t+Math.atan2(Math.sin(E)*Math.sin(c/O)*Math.cos(e*t),Math.cos(c/O)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:R/t}}function q(e,a,n,o){const t=Math.PI/180,f=(n-e)*t,u=(o-a)*t,p=Math.sin(f/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(u/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function D(e){alert(e)}function x(e,a,n,o){const c=e*Math.PI/180,t=n*Math.PI/180,f=(o-a)*Math.PI/180,u=Math.sin(f)*Math.cos(t),p=Math.cos(c)*Math.sin(t)-Math.sin(c)*Math.cos(t)*Math.cos(f);let E=Math.atan2(u,p);return E=E*180/Math.PI,(E+360)%360}function Q(e){const[a,n,o,c]=e,t=2*(c*a+n*o),f=1-2*(a*a+n*n),u=Math.atan2(t,f),p=2*(c*n-o*a);let E;Math.abs(p)>=1?E=Math.sign(p)*Math.PI/2:E=Math.asin(p);const O=2*(c*o+a*n),A=1-2*(n*n+o*o);let R=Math.atan2(O,A)*180/Math.PI;return R<0&&(R+=360),{roll:u*180/Math.PI,pitch:E*180/Math.PI,yaw:R}}function U(e,a){let n=Math.abs(e-a)%360;return n>180&&(n=360-n),n}function j(e,a,n,o,c){const t=x(o,c,a,n),u=Q(e).yaw;U(u,t)<15?S():w.style.color="red"}function S(){w.style.color="green"}};
