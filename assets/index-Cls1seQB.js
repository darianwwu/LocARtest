(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))M(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const n of u.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&M(n)}).observe(document,{childList:!0,subtree:!0});function c(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function M(r){if(r.ep)return;r.ep=!0;const u=c(r);fetch(r.href,u)}})();const H=navigator.userAgent.match(/iPhone|iPad|iPod/i);function P(O){const e=this;this.object=O,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const c=function({alpha:n,beta:d,gamma:f,webkitCompassHeading:p}){if(H){const g=360-p;e.alphaOffset=THREE.MathUtils.degToRad(g-n),e.deviceOrientation={alpha:n,beta:d,gamma:f,webkitCompassHeading:p}}else n<0&&(n+=360),e.deviceOrientation={alpha:n,beta:d,gamma:f};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:O.rotation}}))},M=function(){e.screenOrientation=window.orientation||0},r=(function(){window.addEventListener("orientationchange",M,!1),H?window.addEventListener("deviceorientation",c,!1):window.addEventListener("deviceorientationabsolute",c,!1)}).bind(this),u=function(){const n=new THREE.Vector3(0,0,1),d=new THREE.Euler,f=new THREE.Quaternion,p=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(g,y,b,v,C){d.set(b,y,-v,"YXZ"),g.setFromEuler(d),g.multiply(p),g.multiply(f.setFromAxisAngle(n,-C))}}();this.connect=function(){M(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(n){n=="granted"&&r()}).catch(function(n){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",n)}):r(),e.enabled=!0},this.disconnect=function(){H?(window.removeEventListener("orientationchange",M,!1),window.removeEventListener("deviceorientation",c,!1)):(window.removeEventListener("orientationchange",M,!1),window.removeEventListener("deviceorientationabsolute",c,!1)),e.enabled=!1,e.initialOffset=!1,e.deviceOrientation=null},this.update=function({theta:n=0}={theta:0}){if(e.enabled===!1)return;const d=e.deviceOrientation;if(d){const f=d.alpha?THREE.MathUtils.degToRad(d.alpha):0,p=d.beta?THREE.MathUtils.degToRad(d.beta):0,g=d.gamma?THREE.MathUtils.degToRad(d.gamma):0,y=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;if(H){const b=new THREE.Quaternion;u(b,f,p,g,y);const v=new THREE.Euler().setFromQuaternion(b,"YXZ");console.log(v.x,v.y,v.z),v.y=THREE.MathUtils.degToRad(360-d.webkitCompassHeading),b.setFromEuler(v),e.object.quaternion.copy(b)}else u(e.object.quaternion,f+n,p,g,y)}},this.updateAlphaOffset=function(){e.initialOffset=!1},this.dispose=function(){e.disconnect()},this.getAlpha=function(){const{deviceOrientation:n}=e;return n&&n.alpha?THREE.MathUtils.degToRad(n.alpha)+e.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:n}=e;return n&&n.beta?THREE.MathUtils.degToRad(n.beta):0},this.getGamma=function(){const{deviceOrientation:n}=e;return n&&n.gamma?THREE.MathUtils.degToRad(n.gamma):0},this.connect()}P.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:P});window.onload=()=>{let O=!1;const e={latitude:51.935175,longitude:7.649708},c={latitude:null,longitude:null},M=[3,5.5,12],r=document.querySelector("a-scene"),u=document.querySelector("[gps-new-camera]");u.setAttribute("camera",{far:100});const n=document.createElement("div");n.id="distanceDisplay",document.body.appendChild(n);const d=document.createElement("div");d.id="compassContainer",document.body.appendChild(d);const f=document.createElement("div");f.id="compassArrow",f.innerText="↑",d.appendChild(f);const p=document.createElement("div");p.id="compassText",d.appendChild(p);var g=new P(u.object3D);window.addEventListener("camera-rotation-change",i=>{g.update();let a=y();p.innerText=`${Math.round(a)}°`,f.style.transform=`rotate(${-a}deg)`,c.latitude!==null&&c.longitude!==null&&U(g.object.quaternion,c.latitude,c.longitude,e.latitude,e.longitude)});function y(){if(P.isIOS&&g.deviceOrientation)return g.deviceOrientation.webkitCompassHeading||0;{const i=g.object.quaternion,a=new THREE.Euler().setFromQuaternion(i,"YXZ");let t=THREE.MathUtils.radToDeg(a.y);return t=Math.abs((t-360)%360),t}}u.addEventListener("gps-camera-update-position",i=>{if(c.latitude=i.detail.position.latitude,c.longitude=i.detail.position.longitude,c.latitude&&c.longitude){const a=C(c.latitude,c.longitude,e.latitude,e.longitude);if(n.innerText=`Entfernung zum Ziel: ${Math.round(a)} m`,document.querySelectorAll("a-sphere").forEach(t=>t.remove()),M.forEach((t,l)=>{const s=document.createElement("a-sphere");s.setAttribute("color","#00008B"),s.setAttribute("opacity","0.7");const o=b(c.latitude,c.longitude,e.latitude,e.longitude,t);s.setAttribute("gps-new-entity-place",{latitude:o.latitude,longitude:o.longitude});let h;l===0?h=.3:l===1?h=.4:l===2&&(h=.65),s.setAttribute("radius",h.toString()),r.appendChild(s)}),!O){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:e.latitude,longitude:e.longitude}),r.appendChild(t),O=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),L("Keine aktuellen Koordinaten vorhanden!")});function b(i,a,t,l,s){return v(i,a,t,l,s)}function v(i,a,t,l,s){const o=Math.PI/180,h=(l-a)*o,w=Math.sin(h)*Math.cos(t*o),m=Math.cos(i*o)*Math.sin(t*o)-Math.sin(i*o)*Math.cos(t*o)*Math.cos(h),E=Math.atan2(w,m),T=6371e3,A=Math.asin(Math.sin(i*o)*Math.cos(s/T)+Math.cos(i*o)*Math.sin(s/T)*Math.cos(E)),R=a*o+Math.atan2(Math.sin(E)*Math.sin(s/T)*Math.cos(i*o),Math.cos(s/T)-Math.sin(i*o)*Math.sin(A));return{latitude:A/o,longitude:R/o}}function C(i,a,t,l){const o=Math.PI/180,h=(t-i)*o,w=(l-a)*o,m=Math.sin(h/2)**2+Math.cos(i*o)*Math.cos(t*o)*Math.sin(w/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function L(i){alert(i)}function I(i,a,t,l){const s=i*Math.PI/180,o=t*Math.PI/180,h=(l-a)*Math.PI/180,w=Math.sin(h)*Math.cos(o),m=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(h);let E=Math.atan2(w,m);return E=E*180/Math.PI,(E+360)%360}function D(i){const a=i.x,t=i.y,l=i.z,s=i.w,o=2*(s*a+t*l),h=1-2*(a*a+t*t),w=Math.atan2(o,h),m=2*(s*t-l*a);let E;Math.abs(m)>=1?E=Math.sign(m)*Math.PI/2:E=Math.asin(m);const T=2*(s*l+a*t),A=1-2*(t*t+l*l);let R=Math.atan2(T,A)*180/Math.PI;return R<0&&(R+=360),{roll:w*180/Math.PI,pitch:E*180/Math.PI,yaw:R}}function q(i,a){let t=Math.abs(i-a)%360;return t>180&&(t=360-t),t}function U(i,a,t,l,s){const o=I(l,s,a,t),w=D(i).yaw;q(w,o)<15?j():f.style.color="red"}function j(){f.style.color="green"}};
