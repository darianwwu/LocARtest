(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))w(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const M of c.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&w(M)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function w(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();window.onload=()=>{let A=!1;const d={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},w=[3,6,12],s=document.querySelector("a-scene"),c=document.querySelector("[gps-new-camera]");c.setAttribute("camera",{far:100});const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const b=document.createElement("div");b.id="compassContainer",document.body.appendChild(b);const f=document.createElement("div");f.id="compassArrow",f.innerText="↑",b.appendChild(f);const P=document.createElement("div");P.id="compassText",b.appendChild(P);const v=c.components["gps-new-camera"].latLonToWorld(d.latitude,d.longitude),E=0;let g;if("AbsoluteOrientationSensor"in window)g=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)g=new RelativeOrientationSensor({frequency:60});else{L("Gerät unterstützt keine Orientation Sensoren.");return}g.addEventListener("reading",()=>{[...g.quaternion],I(g.quaternion),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),z(g.quaternion,r.latitude,r.longitude,d.latitude,d.longitude))}),g.addEventListener("error",e=>{console.error("Sensor error: ",e.error),L("Fehler beim Sensor!")}),g.start(),c.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const a=T(r.latitude,r.longitude,d.latitude,d.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(a)} m`;let n=0;if(document.querySelectorAll("a-triangle").forEach(o=>o.remove()),w.forEach(o=>{const i=document.createElement("a-triangle");i.setAttribute("color","#00008B"),i.setAttribute("opacity","0.7");const t=O(r.latitude,r.longitude,d.latitude,d.longitude,o,n);i.setAttribute("gps-new-entity-place",{latitude:t.latitude,longitude:t.longitude}),console.log("gps-new-camera: "),i.setAttribute("look-at",`${v[0]} ${E} ${v[1]}`),s.appendChild(i)}),!A){const o=document.createElement("a-image");o.setAttribute("src","./images/map-marker.png"),o.setAttribute("width","4"),o.setAttribute("height","4"),o.setAttribute("look-at","[gps-new-camera]"),o.setAttribute("gps-new-entity-place",{latitude:d.latitude,longitude:d.longitude}),s.appendChild(o),A=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),L("Keine aktuellen Koordinaten vorhanden!")});function I(e){if(!e)return;const a=q(e);f.style.transform=`rotate(${-a}deg)`,P.innerText=`${Math.round(a)}°`}function q(e){let[a,n,o,i]=e,t=Math.atan2(2*(i*o+a*n),1-2*(n*n+o*o))*180/Math.PI;return t<0&&(t+=360),t}function O(e,a,n,o,i,t){const u=S(e,a,n,o,i),p=u.latitude-e,l=u.longitude-a,h=p*Math.cos(t)-l*Math.sin(t),m=p*Math.sin(t)+l*Math.cos(t);return{latitude:e+h,longitude:a+m}}function S(e,a,n,o,i){const t=Math.PI/180,u=(o-a)*t,p=Math.sin(u)*Math.cos(n*t),l=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(u),h=Math.atan2(p,l),m=6371e3,C=Math.asin(Math.sin(e*t)*Math.cos(i/m)+Math.cos(e*t)*Math.sin(i/m)*Math.cos(h)),y=a*t+Math.atan2(Math.sin(h)*Math.sin(i/m)*Math.cos(e*t),Math.cos(i/m)-Math.sin(e*t)*Math.sin(C));return{latitude:C/t,longitude:y/t}}function T(e,a,n,o){const t=Math.PI/180,u=(n-e)*t,p=(o-a)*t,l=Math.sin(u/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(p/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function L(e){alert(e)}function x(e,a,n,o){const i=e*Math.PI/180,t=n*Math.PI/180,u=(o-a)*Math.PI/180,p=Math.sin(u)*Math.cos(t),l=Math.cos(i)*Math.sin(t)-Math.sin(i)*Math.cos(t)*Math.cos(u);let h=Math.atan2(p,l);return h=h*180/Math.PI,(h+360)%360}function $(e){const[a,n,o,i]=e,t=2*(i*a+n*o),u=1-2*(a*a+n*n),p=Math.atan2(t,u),l=2*(i*n-o*a);let h;Math.abs(l)>=1?h=Math.sign(l)*Math.PI/2:h=Math.asin(l);const m=2*(i*o+a*n),C=1-2*(n*n+o*o);let y=Math.atan2(m,C)*180/Math.PI;return y<0&&(y+=360),{roll:p*180/Math.PI,pitch:h*180/Math.PI,yaw:y}}function k(e,a){let n=Math.abs(e-a)%360;return n>180&&(n=360-n),n}function z(e,a,n,o,i){const t=x(o,i,a,n),p=$(e).yaw;k(p,t)<15?K():f.style.color="red"}function K(){console.log("Ziel ausgerichtet!"),f.style.color="green"}};
