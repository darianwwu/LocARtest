(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))m(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&m(u)}).observe(document,{childList:!0,subtree:!0});function y(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function m(n){if(n.ep)return;n.ep=!0;const r=y(n);fetch(n.href,r)}})();window.onload=()=>{let M=!1;const d={latitude:51.934548,longitude:7.653734},y=[3,6,12],m=document.querySelector("a-scene"),n=document.querySelector("[gps-new-camera]");n.setAttribute("camera",{far:100});const r=document.createElement("div");r.id="distanceDisplay",document.body.appendChild(r);const u=document.createElement("div");u.id="compassContainer",document.body.appendChild(u);const h=document.createElement("div");h.id="compassArrow",h.innerText="↑",u.appendChild(h);const w=document.createElement("div");w.id="compassText",u.appendChild(w);let g;"AbsoluteOrientationSensor"in window?g=new AbsoluteOrientationSensor({frequency:60}):"RelativeOrientationSensor"in window?g=new RelativeOrientationSensor({frequency:60}):console.error("Keine native Orientierungssensor-Unterstützung vorhanden!"),g&&(g.addEventListener("reading",()=>{const s=g.quaternion,i=C(s);if(h.style.transform=`rotate(${-i}deg)`,w.innerText=`${Math.round(i)}°`,typeof window.currentTargetBearing<"u"){let t=Math.abs(i-window.currentTargetBearing);t>180&&(t=360-t),t<=10?h.style.color="green":h.style.color="white"}}),g.start()),n.addEventListener("gps-camera-update-position",s=>{const i=s.detail.position.latitude,t=s.detail.position.longitude;console.log("Aktualisierte Nutzerposition");const c=v(i,t,d.latitude,d.longitude);console.log("Entfernung zum Ziel:",c),r.innerText=`Entfernung zum Ziel: ${Math.round(c)} m`;const a=I(i,t,d.latitude,d.longitude);if(console.log("Berechneter Zielwinkel:",a),window.currentTargetBearing=a,!M){console.log("Füge Marker am Ziel hinzu...");const e=document.createElement("a-image");e.setAttribute("src","./images/map-marker.png"),e.setAttribute("width","4"),e.setAttribute("height","4"),e.setAttribute("gps-new-entity-place",{latitude:d.latitude,longitude:d.longitude}),m.appendChild(e),M=!0}document.querySelectorAll("a-triangle").forEach(e=>e.remove()),console.log("Alte Dreiecke entfernt."),y.forEach(e=>{const o=L(i,t,d.latitude,d.longitude,e);if(console.log(`Dreieck bei Distanz ${e}m:`,o),!o||!o.latitude||!o.longitude){console.error("Fehler: Berechnete GPS-Koordinaten sind ungültig.",o);return}const l=document.createElement("a-triangle");l.setAttribute("color","#00008B"),l.setAttribute("opacity","0.7"),l.setAttribute("gps-new-entity-place",{latitude:o.latitude,longitude:o.longitude}),m.appendChild(l)})});function v(s,i,t,c){const e=Math.PI/180,o=(t-s)*e,l=(c-i)*e,b=Math.sin(o/2)**2+Math.cos(s*e)*Math.cos(t*e)*Math.sin(l/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))}function I(s,i,t,c){const a=Math.PI/180,e=Math.sin((c-i)*a)*Math.cos(t*a),o=Math.cos(s*a)*Math.sin(t*a)-Math.sin(s*a)*Math.cos(t*a)*Math.cos((c-i)*a);return(Math.atan2(e,o)*(180/Math.PI)+360)%360}function L(s,i,t,c,a){const e=s*Math.PI/180,o=i*Math.PI/180,l=t*Math.PI/180,A=c*Math.PI/180-o,O=Math.sin(A)*Math.cos(l),q=Math.cos(e)*Math.sin(l)-Math.sin(e)*Math.cos(l)*Math.cos(A),P=Math.atan2(O,q),f=6371e3,p=a,E=Math.asin(Math.sin(e)*Math.cos(p/f)+Math.cos(e)*Math.sin(p/f)*Math.cos(P)),S=o+Math.atan2(Math.sin(P)*Math.sin(p/f)*Math.cos(e),Math.cos(p/f)-Math.sin(e)*Math.sin(E));return{latitude:E*180/Math.PI,longitude:S*180/Math.PI}}function C(s){let[i,t,c,a]=s,o=Math.atan2(2*(a*c+i*t),1-2*(t*t+c*c))*(180/Math.PI);return o<0&&(o+=360),o}};
