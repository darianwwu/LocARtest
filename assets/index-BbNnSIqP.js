(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const e of i.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&l(e)}).observe(document,{childList:!0,subtree:!0});function v(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=v(o);fetch(o.href,i)}})();const y=navigator.userAgent.match(/iPhone|iPad|iPod/i);function R(O){const n=this;this.object=O,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const v=function({alpha:e,beta:s,gamma:m,webkitCompassHeading:p}){if(y){const u=360-p;n.alphaOffset=THREE.MathUtils.degToRad(u-e),n.deviceOrientation={alpha:e,beta:s,gamma:m,webkitCompassHeading:p}}else e<0&&(e+=360),n.deviceOrientation={alpha:e,beta:s,gamma:m};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:O.rotation}}))},l=function(){n.screenOrientation=window.orientation||0},o=(function(){window.addEventListener("orientationchange",l,!1),y?window.addEventListener("deviceorientation",v,!1):window.addEventListener("deviceorientationabsolute",v,!1)}).bind(this),i=function(){const e=new THREE.Vector3(0,0,1),s=new THREE.Euler,m=new THREE.Quaternion,p=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(u,w,E,f,b){s.set(E,w,-f,"YXZ"),u.setFromEuler(s),u.multiply(p),u.multiply(m.setFromAxisAngle(e,-b))}}();this.connect=function(){l(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&o()}).catch(function(e){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):o(),n.enabled=!0},this.disconnect=function(){y?(window.removeEventListener("orientationchange",l,!1),window.removeEventListener("deviceorientation",v,!1)):(window.removeEventListener("orientationchange",l,!1),window.removeEventListener("deviceorientationabsolute",v,!1)),n.enabled=!1,n.initialOffset=!1,n.deviceOrientation=null},this.update=function({theta:e=0}={theta:0}){if(n.enabled===!1)return;const s=n.deviceOrientation;if(s){const m=s.alpha?THREE.MathUtils.degToRad(s.alpha):0,p=s.beta?THREE.MathUtils.degToRad(s.beta):0,u=s.gamma?THREE.MathUtils.degToRad(s.gamma):0,w=n.screenOrientation?THREE.MathUtils.degToRad(n.screenOrientation):0;if(y){const E=new THREE.Quaternion;i(E,m,p,u,w);const f=new THREE.Euler().setFromQuaternion(E,"YXZ");console.log(f.x,f.y,f.z),f.y=THREE.MathUtils.degToRad(360-s.webkitCompassHeading),E.setFromEuler(f),n.object.quaternion.copy(E)}else i(n.object.quaternion,m+e,p,u,w)}},this.updateAlphaOffset=function(){n.initialOffset=!1},this.dispose=function(){n.disconnect()},this.getAlpha=function(){const{deviceOrientation:e}=n;return e&&e.alpha?THREE.MathUtils.degToRad(e.alpha)+n.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:e}=n;return e&&e.beta?THREE.MathUtils.degToRad(e.beta):0},this.getGamma=function(){const{deviceOrientation:e}=n;return e&&e.gamma?THREE.MathUtils.degToRad(e.gamma):0},this.connect()}R.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:R});window.onload=()=>{let O=!1,n=null,v=null,l=null;const o={latitude:51.935175,longitude:7.649708},i={latitude:null,longitude:null},e=[3,5.5,12],s=document.querySelector("a-scene"),m=document.querySelector("[gps-new-camera]");m.setAttribute("camera",{far:100});const p=document.createElement("div");p.id="distanceDisplay",document.body.appendChild(p);const u=document.createElement("div");u.id="compassContainer",document.body.appendChild(u);const w=document.createElement("div");w.id="compassArrow",w.innerText="↑",u.appendChild(w);const E=document.createElement("div");E.id="compassText",u.appendChild(E);const f=document.createElement("button");f.id="placeSpheresButton",f.innerText="Kugeln platzieren",document.body.appendChild(f);const b=new R(m.object3D);window.addEventListener("camera-rotation-change",()=>{b.update(),R.isIOS&&b.deviceOrientation&&l===null&&(n=C(b.object.quaternion),v=b.deviceOrientation.webkitCompassHeading||0,l=(v-n+360)%360,console.log("Kalibrierungs-Offset:",l));let a;R.isIOS&&b.deviceOrientation?a=b.deviceOrientation.webkitCompassHeading||0:a=A(b.object.quaternion),E.innerText=`${Math.round(a)}°`,w.style.transform=`rotate(${-a}deg)`}),m.addEventListener("gps-camera-update-position",a=>{if(i.latitude=a.detail.position.latitude,i.longitude=a.detail.position.longitude,i.latitude&&i.longitude){const d=P(i.latitude,i.longitude,o.latitude,o.longitude);p.innerText=`Entfernung zum Ziel: ${Math.round(d)} m`}else console.error("Keine aktuellen Koordinaten vorhanden!")}),f.addEventListener("click",()=>{if(i.latitude===null||i.longitude===null){alert("GPS-Daten sind noch nicht verfügbar.");return}const a=q(i.latitude,i.longitude,o.latitude,o.longitude);let d=a;if(R.isIOS&&l!==null&&(d=(a-l+360)%360,console.log("Original Bearing:",a,"-> AR Bearing:",d)),document.querySelectorAll("a-sphere").forEach(t=>t.remove()),e.forEach((t,h)=>{const c=document.createElement("a-sphere");c.setAttribute("color","#00008B"),c.setAttribute("opacity","0.7");const r=L(i.latitude,i.longitude,t,d);c.setAttribute("gps-new-entity-place",{latitude:r.latitude,longitude:r.longitude});let g;h===0?g=.3:h===1?g=.4:h===2&&(g=.65),c.setAttribute("radius",g.toString()),s.appendChild(c)}),!O){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:o.latitude,longitude:o.longitude}),s.appendChild(t),O=!0}});function A(a){const d=new THREE.Euler().setFromQuaternion(a,"YXZ");let t=THREE.MathUtils.radToDeg(d.y);return t=Math.abs((t-360)%360),t}function C(a){const{x:d,y:t,z:h,w:c}=a;let r=Math.atan2(2*(c*h+d*t),1-2*(t*t+h*h))*180/Math.PI;return r<0&&(r+=360),r}function L(a,d,t,h){const c=Math.PI/180,r=6371e3,g=h*c,M=a*c,T=d*c,H=Math.asin(Math.sin(M)*Math.cos(t/r)+Math.cos(M)*Math.sin(t/r)*Math.cos(g)),D=T+Math.atan2(Math.sin(g)*Math.sin(t/r)*Math.cos(M),Math.cos(t/r)-Math.sin(M)*Math.sin(H));return{latitude:H/c,longitude:D/c}}function P(a,d,t,h){const r=Math.PI/180,g=(t-a)*r,M=(h-d)*r,T=Math.sin(g/2)**2+Math.cos(a*r)*Math.cos(t*r)*Math.sin(M/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T)))}function q(a,d,t,h){const c=a*Math.PI/180,r=t*Math.PI/180,g=(h-d)*Math.PI/180,M=Math.sin(g)*Math.cos(r),T=Math.cos(c)*Math.sin(r)-Math.sin(c)*Math.cos(r)*Math.cos(g);return(Math.atan2(M,T)*180/Math.PI+360)%360}};
