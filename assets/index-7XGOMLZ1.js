(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function g(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(d){if(d.ep)return;d.ep=!0;const l=g(d);fetch(d.href,l)}})();const P=navigator.userAgent.match(/iPhone|iPad|iPod/i);function L(T){const s=this;this.object=T,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const g=function({alpha:o,beta:u,gamma:y,webkitCompassHeading:M}){if(console.log("alpha",o,"beta",u,"gamma",y,"webkitCompassHeading",M),P){const m=360-M;s.alphaOffset=THREE.MathUtils.degToRad(m-o),s.deviceOrientation={alpha:o,beta:u,gamma:y,webkitCompassHeading:M}}else o<0&&(o+=360),s.deviceOrientation={alpha:o,beta:u,gamma:y};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:T.rotation}}))},r=function(){s.screenOrientation=window.orientation||0},d=(function(){window.addEventListener("orientationchange",r,!1),P?window.addEventListener("deviceorientation",g,!1):window.addEventListener("deviceorientationabsolute",g,!1)}).bind(this),l=function(){const o=new THREE.Vector3(0,0,1),u=new THREE.Euler,y=new THREE.Quaternion,M=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(m,w,v,b,C){u.set(v,w,-b,"YXZ"),m.setFromEuler(u),m.multiply(M),m.multiply(y.setFromAxisAngle(o,-C))}}();this.connect=function(){r(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(o){o=="granted"&&d()}).catch(function(o){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",o)}):d(),s.enabled=!0},this.disconnect=function(){P?(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientation",g,!1)):(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientationabsolute",g,!1)),s.enabled=!1,s.initialOffset=!1,s.deviceOrientation=null},this.update=function({theta:o=0}={theta:0}){if(s.enabled===!1)return;const u=s.deviceOrientation;if(u){const y=u.alpha?THREE.MathUtils.degToRad(u.alpha):0,M=u.beta?THREE.MathUtils.degToRad(u.beta):0,m=u.gamma?THREE.MathUtils.degToRad(u.gamma):0,w=s.screenOrientation?THREE.MathUtils.degToRad(s.screenOrientation):0;if(P){const v=new THREE.Quaternion;l(v,y,M,m,w);const b=new THREE.Euler().setFromQuaternion(v,"YXZ");console.log(b.x,b.y,b.z),b.y=THREE.MathUtils.degToRad(360-u.webkitCompassHeading),v.setFromEuler(b),s.object.quaternion.copy(v)}else l(s.object.quaternion,y+o,M,m,w)}},this.updateAlphaOffset=function(){s.initialOffset=!1},this.dispose=function(){s.disconnect()},this.getAlpha=function(){const{deviceOrientation:o}=s;return o&&o.alpha?THREE.MathUtils.degToRad(o.alpha)+s.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:o}=s;return o&&o.beta?THREE.MathUtils.degToRad(o.beta):0}}L.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:L});window.onload=()=>{let T=!1,s=null;const g={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},d=[3,5.5,12],l=document.querySelector("a-scene"),o=document.querySelector("[gps-new-camera]");o.setAttribute("camera",{far:100});const u=o.getObject3D("camera");new L(u).connect();const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const m=document.createElement("div");m.id="compassContainer",document.body.appendChild(m);const w=document.createElement("div");w.id="compassArrow",w.innerText="↑",m.appendChild(w);const v=document.createElement("div");v.id="compassText",m.appendChild(v),window.addEventListener("camera-rotation-change",e=>{const a=e.detail.cameraRotation;s=new THREE.Quaternion().setFromEuler(a).toArray(),console.log("currentQuaternion: "+s),b(s),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),j(s,r.latitude,r.longitude,g.latitude,g.longitude))}),o.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const a=q(r.latitude,r.longitude,g.latitude,g.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(a)} m`;let n=0;if(document.querySelectorAll("a-sphere").forEach(i=>i.remove()),d.forEach((i,c)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const f=H(r.latitude,r.longitude,g.latitude,g.longitude,i,n);t.setAttribute("gps-new-entity-place",{latitude:f.latitude,longitude:f.longitude});let h;c===0?h=.3:c===1?h=.4:c===2&&(h=.65),t.setAttribute("radius",h.toString()),l.appendChild(t)}),!T){const i=document.createElement("a-image");i.setAttribute("src","./images/map-marker.png"),i.setAttribute("width","4"),i.setAttribute("height","4"),i.setAttribute("look-at","[gps-new-camera]"),i.setAttribute("gps-new-entity-place",{latitude:g.latitude,longitude:g.longitude}),l.appendChild(i),T=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),D("Keine aktuellen Koordinaten vorhanden!")});function b(e){if(!e)return;const a=C(e);w.style.transform=`rotate(${-a}deg)`,v.innerText=`${Math.round(a)}°`}function C(e){let[a,n,i,c]=e,t=Math.atan2(2*(c*i+a*n),1-2*(n*n+i*i))*180/Math.PI;return t<0&&(t+=360),t}function H(e,a,n,i,c,t){const f=I(e,a,n,i,c),h=f.latitude-e,p=f.longitude-a,E=h*Math.cos(t)-p*Math.sin(t),O=h*Math.sin(t)+p*Math.cos(t);return{latitude:e+E,longitude:a+O}}function I(e,a,n,i,c){const t=Math.PI/180,f=(i-a)*t,h=Math.sin(f)*Math.cos(n*t),p=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(f),E=Math.atan2(h,p),O=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(c/O)+Math.cos(e*t)*Math.sin(c/O)*Math.cos(E)),R=a*t+Math.atan2(Math.sin(E)*Math.sin(c/O)*Math.cos(e*t),Math.cos(c/O)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:R/t}}function q(e,a,n,i){const t=Math.PI/180,f=(n-e)*t,h=(i-a)*t,p=Math.sin(f/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(h/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function D(e){alert(e)}function x(e,a,n,i){const c=e*Math.PI/180,t=n*Math.PI/180,f=(i-a)*Math.PI/180,h=Math.sin(f)*Math.cos(t),p=Math.cos(c)*Math.sin(t)-Math.sin(c)*Math.cos(t)*Math.cos(f);let E=Math.atan2(h,p);return E=E*180/Math.PI,(E+360)%360}function Q(e){const[a,n,i,c]=e,t=2*(c*a+n*i),f=1-2*(a*a+n*n),h=Math.atan2(t,f),p=2*(c*n-i*a);let E;Math.abs(p)>=1?E=Math.sign(p)*Math.PI/2:E=Math.asin(p);const O=2*(c*i+a*n),A=1-2*(n*n+i*i);let R=Math.atan2(O,A)*180/Math.PI;return R<0&&(R+=360),{roll:h*180/Math.PI,pitch:E*180/Math.PI,yaw:R}}function U(e,a){let n=Math.abs(e-a)%360;return n>180&&(n=360-n),n}function j(e,a,n,i,c){const t=x(i,c,a,n),h=Q(e).yaw;U(h,t)<15?S():w.style.color="red"}function S(){w.style.color="green"}};
