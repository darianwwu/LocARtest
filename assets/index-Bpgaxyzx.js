(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))y(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const M of c.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();window.onload=()=>{let b=!1;const u={latitude:51.935175,longitude:7.649708},s={latitude:null,longitude:null},y=[3,6,12],r=document.querySelector("a-scene"),c=document.querySelector("[gps-new-camera]");c.setAttribute("camera",{far:100});const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const m=document.createElement("div");m.id="compassArrow",m.innerText="↑",w.appendChild(m);const A=document.createElement("div");A.id="compassText",w.appendChild(A);let g;if("AbsoluteOrientationSensor"in window)g=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)g=new RelativeOrientationSensor({frequency:60});else{L("Gerät unterstützt keine Orientation Sensoren.");return}g.addEventListener("reading",()=>{[...g.quaternion],v(g.quaternion),s.latitude&&s.longitude&&(console.log("Nutzerstandort:"+s.latitude+" "+s.longitude),z(g.quaternion,s.latitude,s.longitude,u.latitude,u.longitude))}),g.addEventListener("error",t=>{console.error("Sensor error: ",t.error),L("Fehler beim Sensor!")}),g.start(),c.addEventListener("gps-camera-update-position",t=>{if(s.latitude=t.detail.position.latitude,s.longitude=t.detail.position.longitude,s.latitude&&s.longitude){const n=x(s.latitude,s.longitude,u.latitude,u.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(n)} m`}else console.error("Keine aktuellen Koordinaten vorhanden!"),L("Keine aktuellen Koordinaten vorhanden!");let o=0;if(document.querySelectorAll("a-triangle").forEach(n=>n.remove()),y.forEach(n=>{const a=document.createElement("a-triangle");a.setAttribute("color","#00008B"),a.setAttribute("opacity","0.7");const i=C(userLat,userLon,u.latitude,u.longitude,n,o);a.setAttribute("gps-new-entity-place",{latitude:i.latitude,longitude:i.longitude}),a.setAttribute("look-at","[gps-new-camera]"),r.appendChild(a)}),!b){const n=document.createElement("a-image");n.setAttribute("src","./images/map-marker.png"),n.setAttribute("width","4"),n.setAttribute("height","4"),n.setAttribute("look-at","[gps-new-camera]"),n.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),r.appendChild(n),b=!0}});function v(t){if(!t)return;const o=E(t);m.style.transform=`rotate(${-o}deg)`,A.innerText=`${Math.round(o)}°`}function E(t){let[o,n,a,i]=t,e=Math.atan2(2*(i*a+o*n),1-2*(n*n+a*a))*180/Math.PI;return e<0&&(e+=360),e}function C(t,o,n,a,i,e){const d=I(t,o,n,a,i),l=d.latitude-t,h=d.longitude-o,p=l*Math.cos(e)-h*Math.sin(e),f=l*Math.sin(e)+h*Math.cos(e);return{latitude:t+p,longitude:o+f}}function I(t,o,n,a,i){const e=Math.PI/180,d=(a-o)*e,l=Math.sin(d)*Math.cos(n*e),h=Math.cos(t*e)*Math.sin(n*e)-Math.sin(t*e)*Math.cos(n*e)*Math.cos(d),p=Math.atan2(l,h),f=6371e3,P=Math.asin(Math.sin(t*e)*Math.cos(i/f)+Math.cos(t*e)*Math.sin(i/f)*Math.cos(p)),K=o*e+Math.atan2(Math.sin(p)*Math.sin(i/f)*Math.cos(t*e),Math.cos(i/f)-Math.sin(t*e)*Math.sin(P));return{latitude:P/e,longitude:K/e}}function x(t,o,n,a){const e=Math.PI/180,d=(n-t)*e,l=(a-o)*e,h=Math.sin(d/2)**2+Math.cos(t*e)*Math.cos(n*e)*Math.sin(l/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function L(t){alert(t)}function O(t,o,n,a){const i=t*Math.PI/180,e=n*Math.PI/180,d=(a-o)*Math.PI/180,l=Math.sin(d)*Math.cos(e),h=Math.cos(i)*Math.sin(e)-Math.sin(i)*Math.cos(e)*Math.cos(d);let p=Math.atan2(l,h);return p=p*180/Math.PI,(p+360)%360}function S(t){const o=2*(t.w*t.x+t.y*t.z),n=1-2*(t.x*t.x+t.y*t.y),a=Math.atan2(o,n),i=2*(t.w*t.y-t.z*t.x);let e;Math.abs(i)>=1?e=Math.sign(i)*Math.PI/2:e=Math.asin(i);const d=2*(t.w*t.z+t.x*t.y),l=1-2*(t.y*t.y+t.z*t.z),h=Math.atan2(d,l);return{roll:a*180/Math.PI,pitch:e*180/Math.PI,yaw:h*180/Math.PI}}function T(t,o){let n=Math.abs(t-o)%360;return n>180&&(n=360-n),n}function z(t,o,n,a,i){const e=O(o,n,a,i),l=S(t).yaw;T(l,e)<10?k():m.style.color="red"}function k(){console.log("Ziel ausgerichtet!"),m.style.color="green"}};
