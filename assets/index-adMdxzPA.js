(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))f(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&f(p)}).observe(document,{childList:!0,subtree:!0});function w(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function f(s){if(s.ep)return;s.ep=!0;const c=w(s);fetch(s.href,c)}})();window.onload=()=>{let y=!1;const u={latitude:51.935175,longitude:7.649708},w=[3,6,12],f=document.querySelector("a-scene"),s=document.querySelector("[gps-new-camera]");s.setAttribute("camera",{far:100});const c=document.createElement("div");c.id="distanceDisplay",document.body.appendChild(c);const p=document.createElement("div");p.id="compassContainer",document.body.appendChild(p);const M=document.createElement("div");M.id="compassArrow",M.innerText="↑",p.appendChild(M);const b=document.createElement("div");b.id="compassText",p.appendChild(b);let g;if("AbsoluteOrientationSensor"in window)g=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)g=new RelativeOrientationSensor({frequency:60});else{A("Gerät unterstützt keine Orientation Sensoren.");return}g.addEventListener("reading",()=>{[...g.quaternion],P(g.quaternion),console.log("Kamera-Koordinaten: ",s.getAttribute("gps-latitude"),s.getAttribute("gps-longitude")),T(g.quaternion,s.getAttribute("gps-latitude"),s.getAttribute("gps-longitude"),u.latitude,u.longitude)}),g.addEventListener("error",t=>{console.error("Sensor error: ",t.error),A("Fehler beim Sensor!")}),g.start(),s.addEventListener("gps-camera-update-position",t=>{const o=t.detail.position.latitude,n=t.detail.position.longitude,i=v(o,n,u.latitude,u.longitude);c.innerText=`Entfernung zum Ziel: ${Math.round(i)} m`;let a=0;if(document.querySelectorAll("a-triangle").forEach(e=>e.remove()),w.forEach(e=>{const r=document.createElement("a-triangle");r.setAttribute("color","#00008B"),r.setAttribute("opacity","0.7");const d=C(o,n,u.latitude,u.longitude,e,a);r.setAttribute("gps-new-entity-place",{latitude:d.latitude,longitude:d.longitude}),r.setAttribute("look-at","[gps-new-camera]"),f.appendChild(r)}),!y){const e=document.createElement("a-image");e.setAttribute("src","./images/map-marker.png"),e.setAttribute("width","4"),e.setAttribute("height","4"),e.setAttribute("look-at","[gps-new-camera]"),e.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),f.appendChild(e),y=!0}});function P(t){if(!t)return;const o=E(t);M.style.transform=`rotate(${-o}deg)`,b.innerText=`${Math.round(o)}°`}function E(t){let[o,n,i,a]=t,e=Math.atan2(2*(a*i+o*n),1-2*(n*n+i*i))*180/Math.PI;return e<0&&(e+=360),e}function C(t,o,n,i,a,e){const r=I(t,o,n,i,a),d=r.latitude-t,l=r.longitude-o,h=d*Math.cos(e)-l*Math.sin(e),m=d*Math.sin(e)+l*Math.cos(e);return{latitude:t+h,longitude:o+m}}function I(t,o,n,i,a){const e=Math.PI/180,r=(i-o)*e,d=Math.sin(r)*Math.cos(n*e),l=Math.cos(t*e)*Math.sin(n*e)-Math.sin(t*e)*Math.cos(n*e)*Math.cos(r),h=Math.atan2(d,l),m=6371e3,L=Math.asin(Math.sin(t*e)*Math.cos(a/m)+Math.cos(t*e)*Math.sin(a/m)*Math.cos(h)),R=o*e+Math.atan2(Math.sin(h)*Math.sin(a/m)*Math.cos(t*e),Math.cos(a/m)-Math.sin(t*e)*Math.sin(L));return{latitude:L/e,longitude:R/e}}function v(t,o,n,i){const e=Math.PI/180,r=(n-t)*e,d=(i-o)*e,l=Math.sin(r/2)**2+Math.cos(t*e)*Math.cos(n*e)*Math.sin(d/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function A(t){alert(t)}function x(t,o,n,i){const a=t*Math.PI/180,e=n*Math.PI/180,r=(i-o)*Math.PI/180,d=Math.sin(r)*Math.cos(e),l=Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(r);let h=Math.atan2(d,l);return h=h*180/Math.PI,(h+360)%360}function O(t){const o=2*(t.w*t.x+t.y*t.z),n=1-2*(t.x*t.x+t.y*t.y),i=Math.atan2(o,n),a=2*(t.w*t.y-t.z*t.x);let e;Math.abs(a)>=1?e=Math.sign(a)*Math.PI/2:e=Math.asin(a);const r=2*(t.w*t.z+t.x*t.y),d=1-2*(t.y*t.y+t.z*t.z),l=Math.atan2(r,d);return{roll:i*180/Math.PI,pitch:e*180/Math.PI,yaw:l*180/Math.PI}}function S(t,o){let n=Math.abs(t-o)%360;return n>180&&(n=360-n),n}function T(t,o,n,i,a){const e=x(o,n,i,a),d=O(t).yaw;S(d,e)<10?z():M.style.color="red"}function z(){console.log("Ziel ausgerichtet!"),M.style.color="green"}};
