(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function p(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=p(a);fetch(a.href,l)}})();window.onload=()=>{let P=!1,f=null;const p={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},a=[3,5.5,12],l=document.querySelector("a-scene"),m=document.querySelector("[gps-new-camera]");m.setAttribute("camera",{far:100});const E=document.createElement("div");E.id="distanceDisplay",document.body.appendChild(E);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const M=document.createElement("div");M.id="compassArrow",M.innerText="↑",w.appendChild(M);const v=document.createElement("div");v.id="compassText",w.appendChild(v);let y;if("AbsoluteOrientationSensor"in window)y=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)y=new RelativeOrientationSensor({frequency:60});else{C("Gerät unterstützt keine Orientation Sensoren.");return}y.addEventListener("reading",()=>{f=[...y.quaternion],L(f),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),k(f,r.latitude,r.longitude,p.latitude,p.longitude))}),y.addEventListener("error",e=>{console.error("Sensor error: ",e.error),C("Fehler beim Sensor!")}),y.start(),m.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const s=q(r.latitude,r.longitude,p.latitude,p.longitude);E.innerText=`Entfernung zum Ziel: ${Math.round(s)} m`;let o=0;if(document.querySelectorAll("a-sphere").forEach(i=>i.remove()),a.forEach((i,n)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const u=S(r.latitude,r.longitude,p.latitude,p.longitude,i,o);t.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude});let c;n===0?c=.3:n===1?c=.4:n===2&&(c=.65),t.setAttribute("radius",c.toString()),l.appendChild(t)}),!P){const i=document.createElement("a-image");i.setAttribute("src","./images/map-marker.png"),i.setAttribute("width","4"),i.setAttribute("height","4"),i.setAttribute("look-at","[gps-new-camera]"),i.setAttribute("gps-new-entity-place",{latitude:p.latitude,longitude:p.longitude}),l.appendChild(i),P=!0;const n=document.createElement("a-text");n.setAttribute("value","Beispieltext"),n.setAttribute("look-at","[gps-new-camera]"),n.setAttribute("align","center"),n.setAttribute("color","black"),n.setAttribute("z-offset","3"),n.setAttribute("gps-new-entity-place",{latitude:51.935145,longitude:7.652255}),l.appendChild(n),console.log("Erstelltes Element:",n),console.log("Attribute:",n.getAttribute("value")),console.log("GPS-Position:",n.getAttribute("gps-new-entity-place")),console.log("Kinder der Szene:",l.children)}}else console.error("Keine aktuellen Koordinaten vorhanden!"),C("Keine aktuellen Koordinaten vorhanden!")});function L(e){if(!e)return;const s=I(e);M.style.transform=`rotate(${-s}deg)`,v.innerText=`${Math.round(s)}°`}function I(e){let[s,o,i,n]=e,t=Math.atan2(2*(n*i+s*o),1-2*(o*o+i*i))*180/Math.PI;return t<0&&(t+=360),t}function S(e,s,o,i,n,t){const u=O(e,s,o,i,n),c=u.latitude-e,d=u.longitude-s,h=c*Math.cos(t)-d*Math.sin(t),g=c*Math.sin(t)+d*Math.cos(t);return{latitude:e+h,longitude:s+g}}function O(e,s,o,i,n){const t=Math.PI/180,u=(i-s)*t,c=Math.sin(u)*Math.cos(o*t),d=Math.cos(e*t)*Math.sin(o*t)-Math.sin(e*t)*Math.cos(o*t)*Math.cos(u),h=Math.atan2(c,d),g=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(n/g)+Math.cos(e*t)*Math.sin(n/g)*Math.cos(h)),b=s*t+Math.atan2(Math.sin(h)*Math.sin(n/g)*Math.cos(e*t),Math.cos(n/g)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:b/t}}function q(e,s,o,i){const t=Math.PI/180,u=(o-e)*t,c=(i-s)*t,d=Math.sin(u/2)**2+Math.cos(e*t)*Math.cos(o*t)*Math.sin(c/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function C(e){alert(e)}function x(e,s,o,i){const n=e*Math.PI/180,t=o*Math.PI/180,u=(i-s)*Math.PI/180,c=Math.sin(u)*Math.cos(t),d=Math.cos(n)*Math.sin(t)-Math.sin(n)*Math.cos(t)*Math.cos(u);let h=Math.atan2(c,d);return h=h*180/Math.PI,(h+360)%360}function T(e){const[s,o,i,n]=e,t=2*(n*s+o*i),u=1-2*(s*s+o*o),c=Math.atan2(t,u),d=2*(n*o-i*s);let h;Math.abs(d)>=1?h=Math.sign(d)*Math.PI/2:h=Math.asin(d);const g=2*(n*i+s*o),A=1-2*(o*o+i*i);let b=Math.atan2(g,A)*180/Math.PI;return b<0&&(b+=360),{roll:c*180/Math.PI,pitch:h*180/Math.PI,yaw:b}}function z(e,s){let o=Math.abs(e-s)%360;return o>180&&(o=360-o),o}function k(e,s,o,i,n){const t=x(i,n,s,o),c=T(e).yaw;z(c,t)<15?K():M.style.color="red"}function K(){console.log("Ziel ausgerichtet!"),M.style.color="green"}};
