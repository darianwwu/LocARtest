(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function g(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(d){if(d.ep)return;d.ep=!0;const l=g(d);fetch(d.href,l)}})();const P=navigator.userAgent.match(/iPhone|iPad|iPod/i);function L(T){const o=this;this.object=T,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const g=function({alpha:i,beta:u,gamma:b,webkitCompassHeading:E}){if(console.log("alpha",i,"beta",u,"gamma",b,"webkitCompassHeading",E),P){const m=360-E;o.alphaOffset=THREE.MathUtils.degToRad(m-i),o.deviceOrientation={alpha:i,beta:u,gamma:b,webkitCompassHeading:E}}else i<0&&(i+=360),o.deviceOrientation={alpha:i,beta:u,gamma:b};o.update(),window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraQuaternion:o.object.quaternion.clone()}}))},r=function(){o.screenOrientation=window.orientation||0},d=(function(){window.addEventListener("orientationchange",r,!1),P?window.addEventListener("deviceorientation",g,!1):window.addEventListener("deviceorientationabsolute",g,!1)}).bind(this),l=function(){const i=new THREE.Vector3(0,0,1),u=new THREE.Euler,b=new THREE.Quaternion,E=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(m,w,v,y,C){u.set(v,w,-y,"YXZ"),m.setFromEuler(u),m.multiply(E),m.multiply(b.setFromAxisAngle(i,-C))}}();this.connect=function(){r(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(i){i=="granted"&&d()}).catch(function(i){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",i)}):d(),o.enabled=!0},this.disconnect=function(){P?(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientation",g,!1)):(window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientationabsolute",g,!1)),o.enabled=!1,o.initialOffset=!1,o.deviceOrientation=null},this.update=function({theta:i=0}={theta:0}){if(o.enabled===!1)return;const u=o.deviceOrientation;if(u){const b=u.alpha?THREE.MathUtils.degToRad(u.alpha):0,E=u.beta?THREE.MathUtils.degToRad(u.beta):0,m=u.gamma?THREE.MathUtils.degToRad(u.gamma):0,w=o.screenOrientation?THREE.MathUtils.degToRad(o.screenOrientation):0;if(P){const v=new THREE.Quaternion;l(v,b,E,m,w);const y=new THREE.Euler().setFromQuaternion(v,"YXZ");console.log(y.x,y.y,y.z),y.y=THREE.MathUtils.degToRad(360-u.webkitCompassHeading),v.setFromEuler(y),o.object.quaternion.copy(v)}else l(o.object.quaternion,b+i,E,m,w)}},this.updateAlphaOffset=function(){o.initialOffset=!1},this.dispose=function(){o.disconnect()},this.getAlpha=function(){const{deviceOrientation:i}=o;return i&&i.alpha?THREE.MathUtils.degToRad(i.alpha)+o.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:i}=o;return i&&i.beta?THREE.MathUtils.degToRad(i.beta):0}}L.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:L});window.onload=()=>{let T=!1,o=null;const g={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},d=[3,5.5,12],l=document.querySelector("a-scene"),i=document.querySelector("[gps-new-camera]");i.setAttribute("camera",{far:100});const u=i.getObject3D("camera");new L(u).connect();const E=document.createElement("div");E.id="distanceDisplay",document.body.appendChild(E);const m=document.createElement("div");m.id="compassContainer",document.body.appendChild(m);const w=document.createElement("div");w.id="compassArrow",w.innerText="↑",m.appendChild(w);const v=document.createElement("div");v.id="compassText",m.appendChild(v),window.addEventListener("camera-rotation-change",e=>{o=e.detail.cameraQuaternion.toArray(),console.log("currentQuaternion: "+o),y(o),r.latitude&&r.longitude&&(console.log("Nutzerstandort:",r.latitude,r.longitude),U(o,r.latitude,r.longitude,g.latitude,g.longitude))}),i.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const s=q(r.latitude,r.longitude,g.latitude,g.longitude);E.innerText=`Entfernung zum Ziel: ${Math.round(s)} m`;let n=0;if(document.querySelectorAll("a-sphere").forEach(a=>a.remove()),d.forEach((a,c)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const f=H(r.latitude,r.longitude,g.latitude,g.longitude,a,n);t.setAttribute("gps-new-entity-place",{latitude:f.latitude,longitude:f.longitude});let h;c===0?h=.3:c===1?h=.4:c===2&&(h=.65),t.setAttribute("radius",h.toString()),l.appendChild(t)}),!T){const a=document.createElement("a-image");a.setAttribute("src","./images/map-marker.png"),a.setAttribute("width","4"),a.setAttribute("height","4"),a.setAttribute("look-at","[gps-new-camera]"),a.setAttribute("gps-new-entity-place",{latitude:g.latitude,longitude:g.longitude}),l.appendChild(a),T=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),D("Keine aktuellen Koordinaten vorhanden!")});function y(e){if(!e)return;const s=C(e);w.style.transform=`rotate(${-s}deg)`,v.innerText=`${Math.round(s)}°`}function C(e){let[s,n,a,c]=e,t=Math.atan2(2*(c*a+s*n),1-2*(n*n+a*a))*180/Math.PI;return t<0&&(t+=360),t}function H(e,s,n,a,c,t){const f=I(e,s,n,a,c),h=f.latitude-e,p=f.longitude-s,M=h*Math.cos(t)-p*Math.sin(t),O=h*Math.sin(t)+p*Math.cos(t);return{latitude:e+M,longitude:s+O}}function I(e,s,n,a,c){const t=Math.PI/180,f=(a-s)*t,h=Math.sin(f)*Math.cos(n*t),p=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(f),M=Math.atan2(h,p),O=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(c/O)+Math.cos(e*t)*Math.sin(c/O)*Math.cos(M)),R=s*t+Math.atan2(Math.sin(M)*Math.sin(c/O)*Math.cos(e*t),Math.cos(c/O)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:R/t}}function q(e,s,n,a){const t=Math.PI/180,f=(n-e)*t,h=(a-s)*t,p=Math.sin(f/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(h/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function D(e){alert(e)}function j(e,s,n,a){const c=e*Math.PI/180,t=n*Math.PI/180,f=(a-s)*Math.PI/180,h=Math.sin(f)*Math.cos(t),p=Math.cos(c)*Math.sin(t)-Math.sin(c)*Math.cos(t)*Math.cos(f);let M=Math.atan2(h,p);return M=M*180/Math.PI,(M+360)%360}function Q(e){const[s,n,a,c]=e,t=2*(c*s+n*a),f=1-2*(s*s+n*n),h=Math.atan2(t,f),p=2*(c*n-a*s);let M;Math.abs(p)>=1?M=Math.sign(p)*Math.PI/2:M=Math.asin(p);const O=2*(c*a+s*n),A=1-2*(n*n+a*a);let R=Math.atan2(O,A)*180/Math.PI;return R<0&&(R+=360),{roll:h*180/Math.PI,pitch:M*180/Math.PI,yaw:R}}function x(e,s){let n=Math.abs(e-s)%360;return n>180&&(n=360-n),n}function U(e,s,n,a,c){const t=j(a,c,s,n),h=Q(e).yaw;x(h,t)<15?S():w.style.color="red"}function S(){w.style.color="green"}};
