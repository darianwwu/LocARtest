(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function m(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=m(o);fetch(o.href,i)}})();window.onload=()=>{let L=!1,d=null,m=null;const l={latitude:51.935175,longitude:7.649708},o=[3,6,9,12,15],i=document.querySelector("a-scene"),f=document.querySelector("[gps-new-camera]"),I=document.createElement("div");I.id="distanceDisplay",document.body.appendChild(I);const g=document.createElement("div");g.id="compassContainer",document.body.appendChild(g);const y=document.createElement("div");y.id="compassArrow",y.innerText="↑",g.appendChild(y);const S=document.createElement("div");S.id="compassText",g.appendChild(S);const b=document.createElement("button");b.innerText="Kalibrieren",b.classList.add("calib-button"),document.body.appendChild(b),b.addEventListener("click",()=>{m?(d=[...m],E("Kalibrierung gesetzt!")):E("Keine Sensordaten für Kalibrierung verfügbar!")});let h;if("AbsoluteOrientationSensor"in window)h=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)h=new RelativeOrientationSensor({frequency:60});else{E("Gerät unterstützt keine Orientation Sensoren.");return}h.addEventListener("reading",()=>{m=[...h.quaternion],T(h.quaternion)}),h.addEventListener("error",e=>{console.error("Sensor error: ",e.error),E("Fehler beim Sensor!")}),h.start(),f.addEventListener("gps-camera-update-position",e=>{const r=e.detail.position.latitude,a=e.detail.position.longitude,s=K(r,a,l.latitude,l.longitude);I.innerText=`Entfernung zum Ziel: ${Math.round(s)} m`;let u=0;if(d&&(u=w(m)-w(d)),document.querySelectorAll("a-circle").forEach(t=>t.remove()),o.forEach(t=>{const n=document.createElement("a-circle");n.setAttribute("radius","0.5"),n.setAttribute("color","#00008B"),n.setAttribute("opacity","0.7");const c=x(r,a,l.latitude,l.longitude,t,u);n.setAttribute("gps-new-entity-place",{latitude:c.latitude,longitude:c.longitude}),i.appendChild(n)}),!L){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:l.latitude,longitude:l.longitude}),i.appendChild(t),L=!0}});function T(e){if(!e)return;const r=w(e);y.style.transform=`rotate(${-r}deg)`,S.innerText=`${Math.round(r)}°`}function w(e){let[r,a,s,u]=e,n=Math.atan2(2*(u*s+r*a),1-2*(a*a+s*s))*180/Math.PI;return n<0&&(n+=360),d?(n-w(d)+360)%360:n}function x(e,r,a,s,u,t){const n=D(e,r,a,s,u),c=111320,p=40075e3*Math.cos(e*Math.PI/180)/360,M=(n.latitude-e)*c,C=(n.longitude-r)*p,O=C*Math.cos(t)-M*Math.sin(t),P=C*Math.sin(t)+M*Math.cos(t);return{latitude:e+P/c,longitude:r+O/p}}function D(e,r,a,s,u){const t=e*Math.PI/180,n=r*Math.PI/180,c=a*Math.PI/180,M=s*Math.PI/180-n,C=Math.sin(M)*Math.cos(c),O=Math.cos(t)*Math.sin(c)-Math.sin(t)*Math.cos(c)*Math.cos(M),P=Math.atan2(C,O),v=6371e3,A=u,q=Math.asin(Math.sin(t)*Math.cos(A/v)+Math.cos(t)*Math.sin(A/v)*Math.cos(P)),R=n+Math.atan2(Math.sin(P)*Math.sin(A/v)*Math.cos(t),Math.cos(A/v)-Math.sin(t)*Math.sin(q));return{latitude:q*180/Math.PI,longitude:R*180/Math.PI}}function K(e,r,a,s){const t=Math.PI/180,n=(a-e)*t,c=(s-r)*t,p=Math.sin(n/2)**2+Math.cos(e*t)*Math.cos(a*t)*Math.sin(c/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function E(e){alert(e)}};
