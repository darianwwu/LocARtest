(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))y(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const M of c.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();window.onload=()=>{let b=!1;const h={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},y=[3,6,12],s=document.querySelector("a-scene"),c=document.querySelector("[gps-new-camera]");c.setAttribute("camera",{far:100});const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const m=document.createElement("div");m.id="compassArrow",m.innerText="↑",w.appendChild(m);const A=document.createElement("div");A.id="compassText",w.appendChild(A);let p;if("AbsoluteOrientationSensor"in window)p=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)p=new RelativeOrientationSensor({frequency:60});else{P("Gerät unterstützt keine Orientation Sensoren.");return}p.addEventListener("reading",()=>{[...p.quaternion],E(p.quaternion),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),z(p.quaternion,r.latitude,r.longitude,h.latitude,h.longitude))}),p.addEventListener("error",t=>{console.error("Sensor error: ",t.error),P("Fehler beim Sensor!")}),p.start(),c.addEventListener("gps-camera-update-position",t=>{if(r.latitude=t.detail.position.latitude,r.longitude=t.detail.position.longitude,r.latitude&&r.longitude){const i=x(r.latitude,r.longitude,h.latitude,h.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(i)} m`;let o=0;if(document.querySelectorAll("a-triangle").forEach(n=>n.remove()),y.forEach(n=>{const a=document.createElement("a-triangle");a.setAttribute("color","#00008B"),a.setAttribute("opacity","0.7");const e=C(r.latitude,r.longitude,h.latitude,h.longitude,n,o);a.setAttribute("gps-new-entity-place",{latitude:e.latitude,longitude:e.longitude}),a.setAttribute("look-at","[gps-new-camera]"),s.appendChild(a)}),!b){const n=document.createElement("a-image");n.setAttribute("src","./images/map-marker.png"),n.setAttribute("width","4"),n.setAttribute("height","4"),n.setAttribute("look-at","[gps-new-camera]"),n.setAttribute("gps-new-entity-place",{latitude:h.latitude,longitude:h.longitude}),s.appendChild(n),b=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),P("Keine aktuellen Koordinaten vorhanden!")});function E(t){if(!t)return;const i=L(t);m.style.transform=`rotate(${-i}deg)`,A.innerText=`${Math.round(i)}°`}function L(t){let[i,o,n,a]=t,e=Math.atan2(2*(a*n+i*o),1-2*(o*o+n*n))*180/Math.PI;return e<0&&(e+=360),e}function C(t,i,o,n,a,e){const d=I(t,i,o,n,a),u=d.latitude-t,l=d.longitude-i,g=u*Math.cos(e)-l*Math.sin(e),f=u*Math.sin(e)+l*Math.cos(e);return{latitude:t+g,longitude:i+f}}function I(t,i,o,n,a){const e=Math.PI/180,d=(n-i)*e,u=Math.sin(d)*Math.cos(o*e),l=Math.cos(t*e)*Math.sin(o*e)-Math.sin(t*e)*Math.cos(o*e)*Math.cos(d),g=Math.atan2(u,l),f=6371e3,v=Math.asin(Math.sin(t*e)*Math.cos(a/f)+Math.cos(t*e)*Math.sin(a/f)*Math.cos(g)),K=i*e+Math.atan2(Math.sin(g)*Math.sin(a/f)*Math.cos(t*e),Math.cos(a/f)-Math.sin(t*e)*Math.sin(v));return{latitude:v/e,longitude:K/e}}function x(t,i,o,n){const e=Math.PI/180,d=(o-t)*e,u=(n-i)*e,l=Math.sin(d/2)**2+Math.cos(t*e)*Math.cos(o*e)*Math.sin(u/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function P(t){alert(t)}function O(t,i,o,n){const a=t*Math.PI/180,e=o*Math.PI/180,d=(n-i)*Math.PI/180,u=Math.sin(d)*Math.cos(e),l=Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(d);let g=Math.atan2(u,l);return g=g*180/Math.PI,(g+360)%360}function S(t){const i=2*(t.w*t.x+t.y*t.z),o=1-2*(t.x*t.x+t.y*t.y),n=Math.atan2(i,o),a=2*(t.w*t.y-t.z*t.x);let e;Math.abs(a)>=1?e=Math.sign(a)*Math.PI/2:e=Math.asin(a);const d=2*(t.w*t.z+t.x*t.y),u=1-2*(t.y*t.y+t.z*t.z),l=Math.atan2(d,u);return{roll:n*180/Math.PI,pitch:e*180/Math.PI,yaw:l*180/Math.PI}}function T(t,i){let o=Math.abs(t-i)%360;return o>180&&(o=360-o),o}function z(t,i,o,n,a){const e=O(i,o,n,a),u=S(t).yaw,l=T(u,e);console.log("userLat: "+i),console.log("userLon: "+o),console.log("targetLat: "+n),console.log("targetLon: "+a),console.log("sensorQuaternion: "+t),console.log("taregtBearing: "+e),console.log("deviceYaw: "+u),console.log("diff: "+l),l<15?k():m.style.color="red"}function k(){console.log("Ziel ausgerichtet!"),m.style.color="green"}};
