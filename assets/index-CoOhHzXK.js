(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const y of s.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function p(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(r){if(r.ep)return;r.ep=!0;const s=p(r);fetch(r.href,s)}})();window.onload=()=>{let x=!1,l=null,p=null;const c={latitude:51.935175,longitude:7.649708},r=[3,6,9,12],s=document.querySelector("a-scene"),y=document.querySelector("[gps-new-camera]"),I=document.createElement("div");I.id="distanceDisplay",document.body.appendChild(I);const E=document.createElement("div");E.id="compassContainer",document.body.appendChild(E);const P=document.createElement("div");P.id="compassArrow",P.innerText="↑",E.appendChild(P);const S=document.createElement("div");S.id="compassText",E.appendChild(S);const v=document.createElement("button");v.innerText="Kalibrieren",v.classList.add("calib-button"),document.body.appendChild(v),v.addEventListener("click",()=>{p?(l=[...p],C("Kalibrierung gesetzt!")):C("Keine Sensordaten für Kalibrierung verfügbar!")});let m;if("AbsoluteOrientationSensor"in window)m=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)m=new RelativeOrientationSensor({frequency:60});else{C("Gerät unterstützt keine Orientation Sensoren.");return}m.addEventListener("reading",()=>{p=[...m.quaternion],O(m.quaternion)}),m.addEventListener("error",e=>{console.error("Sensor error: ",e.error),C("Fehler beim Sensor!")}),m.start(),y.addEventListener("gps-camera-update-position",e=>{const n=e.detail.position.latitude,a=e.detail.position.longitude,d=F(n,a,c.latitude,c.longitude);I.innerText=`Entfernung zum Ziel: ${Math.round(d)} m`;let u=0;if(l&&(u=L(p)-L(l)),document.querySelectorAll("a-circle").forEach(t=>t.remove()),r.forEach(t=>{const o=document.createElement("a-circle");o.setAttribute("radius","0.5"),o.setAttribute("color","#00008B"),o.setAttribute("opacity","0.7");const i=z(n,a,c.latitude,c.longitude,t,u);o.setAttribute("gps-new-entity-place",{latitude:i.latitude,longitude:i.longitude}),console.log("neuer Kreis mit Entfernung von "+t+" m an Koordinaten "+i.latitude+", "+i.longitude+" hinzugefügt"),console.log("Nutzerkoordinaten: "+n+", "+a);const h=Math.abs(i.latitude-n),g=Math.abs(c.latitude-n),f=h/g*100;console.log("Der Punkt ist "+f.toFixed(2)+"% der Entfernung in lat Richtung vom Nutzerstandort zum Ziel entfernt.");const w=Math.abs(i.longitude-a),M=Math.abs(c.longitude-a),b=w/M*100;console.log("Der Punkt ist "+b.toFixed(2)+"% der Entfernung in lon Richtung vom Nutzerstandort zum Ziel entfernt."),s.appendChild(o)}),!x){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:c.latitude,longitude:c.longitude}),s.appendChild(t),x=!0}});function O(e){if(!e)return;const n=L(e);P.style.transform=`rotate(${-n}deg)`,S.innerText=`${Math.round(n)}°`}function L(e){let[n,a,d,u]=e,o=Math.atan2(2*(u*d+n*a),1-2*(a*a+d*d))*180/Math.PI;return o<0&&(o+=360),l?(o-L(l)+360)%360:o}function z(e,n,a,d,u,t){const o=q(e,n,a,d,u),i=111320,h=40075e3*Math.cos(e*Math.PI/180)/360,g=(o.latitude-e)*i,f=(o.longitude-n)*h,w=f*Math.cos(t)-g*Math.sin(t),M=f*Math.sin(t)+g*Math.cos(t);return{latitude:parseFloat((e+M/i).toFixed(6)),longitude:parseFloat((n+w/h).toFixed(6))}}function q(e,n,a,d,u){const t=e*Math.PI/180,o=n*Math.PI/180,i=a*Math.PI/180,g=d*Math.PI/180-o,f=Math.sin(g)*Math.cos(i),w=Math.cos(t)*Math.sin(i)-Math.sin(t)*Math.cos(i)*Math.cos(g),M=Math.atan2(f,w),b=6371e3,A=u,D=Math.asin(Math.sin(t)*Math.cos(A/b)+Math.cos(t)*Math.sin(A/b)*Math.cos(M)),T=o+Math.atan2(Math.sin(M)*Math.sin(A/b)*Math.cos(t),Math.cos(A/b)-Math.sin(t)*Math.sin(D));return{latitude:D*180/Math.PI,longitude:T*180/Math.PI}}function F(e,n,a,d){const t=Math.PI/180,o=(a-e)*t,i=(d-n)*t,h=Math.sin(o/2)**2+Math.cos(e*t)*Math.cos(a*t)*Math.sin(i/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function C(e){alert(e)}};
