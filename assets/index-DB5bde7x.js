(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function p(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(r){if(r.ep)return;r.ep=!0;const u=p(r);fetch(r.href,u)}})();window.onload=()=>{let E=!1,m=null;const p={latitude:51.935175,longitude:7.649708},s={latitude:null,longitude:null},r=[3,5.5,12],u=document.querySelector("a-scene"),f=document.querySelector("[gps-new-camera]");f.setAttribute("camera",{far:100});const P=document.createElement("div");P.id="distanceDisplay",document.body.appendChild(P);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const M=document.createElement("div");M.id="compassArrow",M.innerText="↑",w.appendChild(M);const v=document.createElement("div");v.id="compassText",w.appendChild(v);let y;if("AbsoluteOrientationSensor"in window)y=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)y=new RelativeOrientationSensor({frequency:60});else{C("Gerät unterstützt keine Orientation Sensoren.");return}y.addEventListener("reading",()=>{m=[...y.quaternion],L(m),s.latitude&&s.longitude&&(console.log("Nutzerstandort:"+s.latitude+" "+s.longitude),z(m,s.latitude,s.longitude,p.latitude,p.longitude))}),y.addEventListener("error",e=>{console.error("Sensor error: ",e.error),C("Fehler beim Sensor!")}),y.start(),f.addEventListener("gps-camera-update-position",e=>{if(s.latitude=e.detail.position.latitude,s.longitude=e.detail.position.longitude,s.latitude&&s.longitude){const a=O(s.latitude,s.longitude,p.latitude,p.longitude);P.innerText=`Entfernung zum Ziel: ${Math.round(a)} m`;let n=0;if(document.querySelectorAll("a-sphere").forEach(o=>o.remove()),r.forEach((o,i)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const d=S(s.latitude,s.longitude,p.latitude,p.longitude,o,n);t.setAttribute("gps-new-entity-place",{latitude:d.latitude,longitude:d.longitude});let c;i===0?c=.3:i===1?c=.4:i===2&&(c=.65),t.setAttribute("radius",c.toString()),u.appendChild(t)}),!E){const o=document.createElement("a-image");o.setAttribute("src","./images/map-marker.png"),o.setAttribute("width","4"),o.setAttribute("height","4"),o.setAttribute("look-at","[gps-new-camera]"),o.setAttribute("gps-new-entity-place",{latitude:p.latitude,longitude:p.longitude}),u.appendChild(o),E=!0;const i=document.createElement("a-image");i.setAttribute("src","./images/map-marker.png"),i.setAttribute("width","8"),i.setAttribute("height","8"),i.setAttribute("look-at","[gps-new-camera]"),i.setAttribute("gps-new-entity-place",{latitude:51.935145,longitude:7.652255}),u.appendChild(i);const t=document.createElement("a-text");t.setAttribute("value","Beispieltext"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("scale",{x:20,y:20,z:20}),t.setAttribute("align","center"),t.setAttribute("gps-new-entity-place",{latitude:51.935145,longitude:7.652255}),u.appendChild(t)}}else console.error("Keine aktuellen Koordinaten vorhanden!"),C("Keine aktuellen Koordinaten vorhanden!")});function L(e){if(!e)return;const a=I(e);M.style.transform=`rotate(${-a}deg)`,v.innerText=`${Math.round(a)}°`}function I(e){let[a,n,o,i]=e,t=Math.atan2(2*(i*o+a*n),1-2*(n*n+o*o))*180/Math.PI;return t<0&&(t+=360),t}function S(e,a,n,o,i,t){const d=x(e,a,n,o,i),c=d.latitude-e,l=d.longitude-a,h=c*Math.cos(t)-l*Math.sin(t),g=c*Math.sin(t)+l*Math.cos(t);return{latitude:e+h,longitude:a+g}}function x(e,a,n,o,i){const t=Math.PI/180,d=(o-a)*t,c=Math.sin(d)*Math.cos(n*t),l=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(d),h=Math.atan2(c,l),g=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(i/g)+Math.cos(e*t)*Math.sin(i/g)*Math.cos(h)),b=a*t+Math.atan2(Math.sin(h)*Math.sin(i/g)*Math.cos(e*t),Math.cos(i/g)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:b/t}}function O(e,a,n,o){const t=Math.PI/180,d=(n-e)*t,c=(o-a)*t,l=Math.sin(d/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(c/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function C(e){alert(e)}function q(e,a,n,o){const i=e*Math.PI/180,t=n*Math.PI/180,d=(o-a)*Math.PI/180,c=Math.sin(d)*Math.cos(t),l=Math.cos(i)*Math.sin(t)-Math.sin(i)*Math.cos(t)*Math.cos(d);let h=Math.atan2(c,l);return h=h*180/Math.PI,(h+360)%360}function T(e){const[a,n,o,i]=e,t=2*(i*a+n*o),d=1-2*(a*a+n*n),c=Math.atan2(t,d),l=2*(i*n-o*a);let h;Math.abs(l)>=1?h=Math.sign(l)*Math.PI/2:h=Math.asin(l);const g=2*(i*o+a*n),A=1-2*(n*n+o*o);let b=Math.atan2(g,A)*180/Math.PI;return b<0&&(b+=360),{roll:c*180/Math.PI,pitch:h*180/Math.PI,yaw:b}}function k(e,a){let n=Math.abs(e-a)%360;return n>180&&(n=360-n),n}function z(e,a,n,o,i){const t=q(o,i,a,n),c=T(e).yaw;k(c,t)<15?K():M.style.color="red"}function K(){console.log("Ziel ausgerichtet!"),M.style.color="green"}};
