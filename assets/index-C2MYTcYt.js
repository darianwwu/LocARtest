(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function p(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=p(o);fetch(o.href,c)}})();window.onload=()=>{let g=!1,u=null,p=null;const i={latitude:51.936389,longitude:7.650431},o=[3,6,9,12],c=document.querySelector("a-scene"),h=document.querySelector("[gps-new-camera]");h.setAttribute("far","1000"),h.setAttribute("fov",N());const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const y=document.createElement("div");y.id="compassContainer",document.body.appendChild(y);const w=document.createElement("div");w.id="compassArrow",w.innerText="↑",y.appendChild(w);const S=document.createElement("div");S.id="compassText",y.appendChild(S);const v=document.createElement("button");v.innerText="Kalibrieren",v.classList.add("calib-button"),document.body.appendChild(v),v.addEventListener("click",()=>{p?(u=[...p],C("Kalibrierung gesetzt!")):C("Keine Sensordaten für Kalibrierung verfügbar!")});let f;if("AbsoluteOrientationSensor"in window)f=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)f=new RelativeOrientationSensor({frequency:60});else{C("Gerät unterstützt keine Orientation Sensoren.");return}f.addEventListener("reading",()=>{p=[...f.quaternion],T(f.quaternion)}),f.addEventListener("error",e=>{console.error("Sensor error: ",e.error),C("Fehler beim Sensor!")}),f.start();function q(e,a,r,l){const s=Math.PI/180,n=Math.sin((l-a)*s)*Math.cos(r*s),t=Math.cos(e*s)*Math.sin(r*s)-Math.sin(e*s)*Math.cos(r*s)*Math.cos((l-a)*s);return(Math.atan2(n,t)*(180/Math.PI)+360)%360}h.addEventListener("gps-camera-update-position",e=>{const a=e.detail.position.latitude,r=e.detail.position.longitude,l=D(a,r,i.latitude,i.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(l)} m`;let s=0;u&&(s=P(p)-P(u));const n=q(a,r,i.latitude,i.longitude);if(document.querySelectorAll("a-triangle").forEach(t=>t.remove()),o.forEach(t=>{const d=document.createElement("a-triangle");d.setAttribute("color","#00008B"),d.setAttribute("opacity","0.7");const m=F(a,r,i.latitude,i.longitude,t,s);d.setAttribute("gps-new-entity-place",{latitude:m.latitude,longitude:m.longitude}),d.setAttribute("rotation",`0 ${n} 0`),c.appendChild(d)}),!g){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:i.latitude,longitude:i.longitude}),c.appendChild(t),g=!0}});function T(e){if(!e)return;const a=P(e);w.style.transform=`rotate(${-a}deg)`,S.innerText=`${Math.round(a)}°`}function P(e){let[a,r,l,s]=e,t=Math.atan2(2*(s*l+a*r),1-2*(r*r+l*l))*180/Math.PI;return t<0&&(t+=360),u?(t-P(u)+360)%360:t}function F(e,a,r,l,s,n){const t=K(e,a,r,l,s),d=111320,m=40075e3*Math.cos(e*Math.PI/180)/360,b=(t.latitude-e)*d,A=(t.longitude-a)*m,O=A*Math.cos(n)-b*Math.sin(n),L=A*Math.sin(n)+b*Math.cos(n);return{latitude:e+L/d,longitude:a+O/m}}function K(e,a,r,l,s){const n=e*Math.PI/180,t=a*Math.PI/180,d=r*Math.PI/180,b=l*Math.PI/180-t,A=Math.sin(b)*Math.cos(d),O=Math.cos(n)*Math.sin(d)-Math.sin(n)*Math.cos(d)*Math.cos(b),L=Math.atan2(A,O),E=6371e3,I=s,x=Math.asin(Math.sin(n)*Math.cos(I/E)+Math.cos(n)*Math.sin(I/E)*Math.cos(L)),B=t+Math.atan2(Math.sin(L)*Math.sin(I/E)*Math.cos(n),Math.cos(I/E)-Math.sin(n)*Math.sin(x));return{latitude:x*180/Math.PI,longitude:B*180/Math.PI}}function D(e,a,r,l){const n=Math.PI/180,t=(r-e)*n,d=(l-a)*n,m=Math.sin(t/2)**2+Math.cos(e*n)*Math.cos(r*n)*Math.sin(d/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function C(e){alert(e)}};async function N(){try{const g=await navigator.mediaDevices.getUserMedia({video:!0}),[u]=g.getVideoTracks(),i=await new ImageCapture(u).getPhotoCapabilities();if(console.log("PhotoCapabilities:",i),i.focalLength&&i.sensorWidth){const o=i.focalLength,c=i.sensorWidth,h=2*Math.atan(c/(2*o))*(180/Math.PI);console.log(`Berechnetes FOV: ${h.toFixed(2)}°`);const M=document.querySelector("a-camera");return M&&M.setAttribute("fov",h.toFixed(2)),h}else return console.log("Native Kamera-Parameter (focalLength und/oder sensorWidth) nicht verfügbar."),null}catch(g){return console.error("Fehler beim Auslesen der Kamera-Parameter:",g),null}finally{}}
