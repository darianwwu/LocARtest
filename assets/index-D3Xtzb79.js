(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))w(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&w(f)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function w(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();require("three/tsl");window.onload=()=>{let P=!1;const h={latitude:51.935175,longitude:7.649708},s={latitude:null,longitude:null},w=[3,6,12],r=document.querySelector("a-scene"),c=document.querySelector("[gps-new-camera]");c.setAttribute("camera",{far:100});const f=document.createElement("div");f.id="distanceDisplay",document.body.appendChild(f);const b=document.createElement("div");b.id="compassContainer",document.body.appendChild(b);const m=document.createElement("div");m.id="compassArrow",m.innerText="↑",b.appendChild(m);const v=document.createElement("div");v.id="compassText",b.appendChild(v);let g;if("AbsoluteOrientationSensor"in window)g=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)g=new RelativeOrientationSensor({frequency:60});else{E("Gerät unterstützt keine Orientation Sensoren.");return}g.addEventListener("reading",()=>{[...g.quaternion],L(g.quaternion),s.latitude&&s.longitude&&(console.log("Nutzerstandort:"+s.latitude+" "+s.longitude),z(g.quaternion,s.latitude,s.longitude,h.latitude,h.longitude))}),g.addEventListener("error",e=>{console.error("Sensor error: ",e.error),E("Fehler beim Sensor!")}),g.start(),c.addEventListener("gps-camera-update-position",e=>{if(s.latitude=e.detail.position.latitude,s.longitude=e.detail.position.longitude,s.latitude&&s.longitude){const i=O(s.latitude,s.longitude,h.latitude,h.longitude);f.innerText=`Entfernung zum Ziel: ${Math.round(i)} m`;let n=0;if(document.querySelectorAll("a-triangle").forEach(o=>o.remove()),w.forEach(o=>{const a=document.createElement("a-triangle");a.setAttribute("color","#00008B"),a.setAttribute("opacity","0.7");const t=I(s.latitude,s.longitude,h.latitude,h.longitude,o,n);a.setAttribute("gps-new-entity-place",{latitude:t.latitude,longitude:t.longitude}),a.setAttribute("rotation","-90 0 0"),r.appendChild(a)}),!P){const o=document.createElement("a-image");o.setAttribute("src","./images/map-marker.png"),o.setAttribute("width","4"),o.setAttribute("height","4"),o.setAttribute("gps-new-entity-place",{latitude:h.latitude,longitude:h.longitude}),r.appendChild(o),P=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),E("Keine aktuellen Koordinaten vorhanden!")});function L(e){if(!e)return;const i=C(e);m.style.transform=`rotate(${-i}deg)`,v.innerText=`${Math.round(i)}°`}function C(e){let[i,n,o,a]=e,t=Math.atan2(2*(a*o+i*n),1-2*(n*n+o*o))*180/Math.PI;return t<0&&(t+=360),t}function I(e,i,n,o,a,t){const u=q(e,i,n,o,a),p=u.latitude-e,d=u.longitude-i,l=p*Math.cos(t)-d*Math.sin(t),M=p*Math.sin(t)+d*Math.cos(t);return{latitude:e+l,longitude:i+M}}function q(e,i,n,o,a){const t=Math.PI/180,u=(o-i)*t,p=Math.sin(u)*Math.cos(n*t),d=Math.cos(e*t)*Math.sin(n*t)-Math.sin(e*t)*Math.cos(n*t)*Math.cos(u),l=Math.atan2(p,d),M=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(a/M)+Math.cos(e*t)*Math.sin(a/M)*Math.cos(l)),y=i*t+Math.atan2(Math.sin(l)*Math.sin(a/M)*Math.cos(e*t),Math.cos(a/M)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:y/t}}function O(e,i,n,o){const t=Math.PI/180,u=(n-e)*t,p=(o-i)*t,d=Math.sin(u/2)**2+Math.cos(e*t)*Math.cos(n*t)*Math.sin(p/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function E(e){alert(e)}function S(e,i,n,o){const a=e*Math.PI/180,t=n*Math.PI/180,u=(o-i)*Math.PI/180,p=Math.sin(u)*Math.cos(t),d=Math.cos(a)*Math.sin(t)-Math.sin(a)*Math.cos(t)*Math.cos(u);let l=Math.atan2(p,d);return l=l*180/Math.PI,(l+360)%360}function T(e){const[i,n,o,a]=e,t=2*(a*i+n*o),u=1-2*(i*i+n*n),p=Math.atan2(t,u),d=2*(a*n-o*i);let l;Math.abs(d)>=1?l=Math.sign(d)*Math.PI/2:l=Math.asin(d);const M=2*(a*o+i*n),A=1-2*(n*n+o*o);let y=Math.atan2(M,A)*180/Math.PI;return y<0&&(y+=360),{roll:p*180/Math.PI,pitch:l*180/Math.PI,yaw:y}}function x(e,i){let n=Math.abs(e-i)%360;return n>180&&(n=360-n),n}function z(e,i,n,o,a){const t=S(o,a,i,n),p=T(e).yaw;x(p,t)<15?K():m.style.color="red"}function K(){console.log("Ziel ausgerichtet!"),m.style.color="green"}};
