(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function p(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(n){if(n.ep)return;n.ep=!0;const i=p(n);fetch(n.href,i)}})();window.onload=()=>{let E=!1,d=null,p=null;const u={latitude:51.935175,longitude:7.649708},n=[3,6,12],i=document.querySelector("a-scene"),g=document.querySelector("[gps-new-camera]");g.setAttribute("camera",{far:100});const C=document.createElement("div");C.id="distanceDisplay",document.body.appendChild(C);const M=document.createElement("div");M.id="compassContainer",document.body.appendChild(M);const b=document.createElement("div");b.id="compassArrow",b.innerText="↑",M.appendChild(b);const v=document.createElement("div");v.id="compassText",M.appendChild(v);const y=document.createElement("button");y.innerText="Kalibrieren",y.classList.add("calib-button"),document.body.appendChild(y),y.addEventListener("click",()=>{p?(d=[...p],L("Kalibrierung gesetzt!")):L("Keine Sensordaten für Kalibrierung verfügbar!")});let m;if("AbsoluteOrientationSensor"in window)m=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)m=new RelativeOrientationSensor({frequency:60});else{L("Gerät unterstützt keine Orientation Sensoren.");return}m.addEventListener("reading",()=>{p=[...m.quaternion],O(m.quaternion)}),m.addEventListener("error",e=>{console.error("Sensor error: ",e.error),L("Fehler beim Sensor!")}),m.start(),g.addEventListener("gps-camera-update-position",e=>{const o=e.detail.position.latitude,r=e.detail.position.longitude,c=x(o,r,u.latitude,u.longitude);C.innerText=`Entfernung zum Ziel: ${Math.round(c)} m`;let s=0;if(d&&(s=w(p)-w(d)),document.querySelectorAll("a-triangle").forEach(t=>t.remove()),n.forEach(t=>{const a=document.createElement("a-triangle");a.setAttribute("color","#00008B"),a.setAttribute("opacity","0.7");const l=q(o,r,u.latitude,u.longitude,t,s);a.setAttribute("gps-new-entity-place",{latitude:l.latitude,longitude:l.longitude}),a.setAttribute("look-at","[gps-new-camera]"),i.appendChild(a)}),!E){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),i.appendChild(t),E=!0}});function O(e){if(!e)return;const o=w(e);b.style.transform=`rotate(${-o}deg)`,v.innerText=`${Math.round(o)}°`}function w(e){let[o,r,c,s]=e,t=Math.atan2(2*(s*c+o*r),1-2*(r*r+c*c))*180/Math.PI;return t<0&&(t+=360),d?(t-w(d)+360)%360:t}function q(e,o,r,c,s,t){const a=T(e,o,r,c,s),l=a.latitude-e,h=a.longitude-o,A=l*Math.cos(t)-h*Math.sin(t),f=l*Math.sin(t)+h*Math.cos(t);return{latitude:e+A,longitude:o+f}}function T(e,o,r,c,s){const t=Math.PI/180,a=(c-o)*t,l=Math.sin(a)*Math.cos(r*t),h=Math.cos(e*t)*Math.sin(r*t)-Math.sin(e*t)*Math.cos(r*t)*Math.cos(a),A=Math.atan2(l,h),f=6371e3,S=Math.asin(Math.sin(e*t)*Math.cos(s/f)+Math.cos(e*t)*Math.sin(s/f)*Math.cos(A)),P=o*t+Math.atan2(Math.sin(A)*Math.sin(s/f)*Math.cos(e*t),Math.cos(s/f)-Math.sin(e*t)*Math.sin(S));return{latitude:S/t,longitude:P/t}}function x(e,o,r,c){const t=Math.PI/180,a=(r-e)*t,l=(c-o)*t,h=Math.sin(a/2)**2+Math.cos(e*t)*Math.cos(r*t)*Math.sin(l/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function L(e){alert(e)}};
