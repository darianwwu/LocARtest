(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const e of h.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&s(e)}).observe(document,{childList:!0,subtree:!0});function u(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(l){if(l.ep)return;l.ep=!0;const h=u(l);fetch(l.href,h)}})();const R=navigator.userAgent.match(/iPhone|iPad|iPod/i);function T(y){const n=this;this.object=y,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const u=function({alpha:e,beta:d,gamma:E,webkitCompassHeading:g}){if(R){const v=360-g;n.alphaOffset=THREE.MathUtils.degToRad(v-e),n.deviceOrientation={alpha:e,beta:d,gamma:E,webkitCompassHeading:g}}else e<0&&(e+=360),n.deviceOrientation={alpha:e,beta:d,gamma:E};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:y.rotation}}))},s=function(){n.screenOrientation=window.orientation||0},l=(function(){window.addEventListener("orientationchange",s,!1),R?window.addEventListener("deviceorientation",u,!1):window.addEventListener("deviceorientationabsolute",u,!1)}).bind(this),h=function(){const e=new THREE.Vector3(0,0,1),d=new THREE.Euler,E=new THREE.Quaternion,g=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(v,m,b,w,H){d.set(b,m,-w,"YXZ"),v.setFromEuler(d),v.multiply(g),v.multiply(E.setFromAxisAngle(e,-H))}}();this.connect=function(){s(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&l()}).catch(function(e){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):l(),n.enabled=!0},this.disconnect=function(){R?(window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",u,!1)):(window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientationabsolute",u,!1)),n.enabled=!1,n.initialOffset=!1,n.deviceOrientation=null},this.update=function({theta:e=0}={theta:0}){if(n.enabled===!1)return;const d=n.deviceOrientation;if(d){const E=d.alpha?THREE.MathUtils.degToRad(d.alpha):0,g=d.beta?THREE.MathUtils.degToRad(d.beta):0,v=d.gamma?THREE.MathUtils.degToRad(d.gamma):0,m=n.screenOrientation?THREE.MathUtils.degToRad(n.screenOrientation):0;if(R){const b=new THREE.Quaternion;h(b,E,g,v,m);const w=new THREE.Euler().setFromQuaternion(b,"YXZ");console.log(w.x,w.y,w.z),w.y=THREE.MathUtils.degToRad(360-d.webkitCompassHeading),b.setFromEuler(w),n.object.quaternion.copy(b)}else h(n.object.quaternion,E+e,g,v,m)}},this.updateAlphaOffset=function(){n.initialOffset=!1},this.dispose=function(){n.disconnect()},this.getAlpha=function(){const{deviceOrientation:e}=n;return e&&e.alpha?THREE.MathUtils.degToRad(e.alpha)+n.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:e}=n;return e&&e.beta?THREE.MathUtils.degToRad(e.beta):0},this.getGamma=function(){const{deviceOrientation:e}=n;return e&&e.gamma?THREE.MathUtils.degToRad(e.gamma):0},this.connect()}T.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:T});window.onload=()=>{let y=!1,n=null;const u={latitude:51.935175,longitude:7.649708},s={latitude:null,longitude:null},l=[3,5.5,12],h=document.querySelector("a-scene"),e=document.querySelector("[gps-new-camera]");e.setAttribute("camera",{far:100});const d=document.createElement("div");d.id="distanceDisplay",document.body.appendChild(d);const E=document.createElement("div");E.id="compassContainer",document.body.appendChild(E);const g=document.createElement("div");g.id="compassArrow",g.innerText="↑",E.appendChild(g);const v=document.createElement("div");v.id="compassText",E.appendChild(v);var m=new T(e.object3D);window.addEventListener("camera-rotation-change",a=>{m.update();let r=b();if(v.innerText=`${Math.round(r)}°`,g.style.transform=`rotate(${-r}deg)`,T.isIOS&&n===null&&m.deviceOrientation){const t=I(m.object.quaternion);n=(m.deviceOrientation.webkitCompassHeading||0)-t,console.log("Kalibrierungs-Offset gesetzt:",n)}s.latitude!==null&&s.longitude!==null&&w(m.object.quaternion,s.latitude,s.longitude,u.latitude,u.longitude)});function b(){if(T.isIOS&&m.deviceOrientation)return m.deviceOrientation.webkitCompassHeading||0;{const a=m.object.quaternion,r=new THREE.Euler().setFromQuaternion(a,"YXZ");let t=THREE.MathUtils.radToDeg(r.y);return t=Math.abs((t-360)%360),t}}e.addEventListener("gps-camera-update-position",a=>{if(s.latitude=a.detail.position.latitude,s.longitude=a.detail.position.longitude,s.latitude&&s.longitude){const r=q(s.latitude,s.longitude,u.latitude,u.longitude);d.innerText=`Entfernung zum Ziel: ${Math.round(r)} m`;let t;if(T.isIOS&&n!==null?t=(A(s.latitude,s.longitude,u.latitude,u.longitude)+n+360)%360:t=A(s.latitude,s.longitude,u.latitude,u.longitude),document.querySelectorAll("a-sphere").forEach(i=>i.remove()),l.forEach((i,c)=>{const o=document.createElement("a-sphere");o.setAttribute("color","#00008B"),o.setAttribute("opacity","0.7");const p=L(s.latitude,s.longitude,i,t);o.setAttribute("gps-new-entity-place",{latitude:p.latitude,longitude:p.longitude});let f;c===0?f=.3:c===1?f=.4:c===2&&(f=.65),o.setAttribute("radius",f.toString()),h.appendChild(o)}),!y){const i=document.createElement("a-image");i.setAttribute("src","./images/map-marker.png"),i.setAttribute("width","4"),i.setAttribute("height","4"),i.setAttribute("look-at","[gps-new-camera]"),i.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),h.appendChild(i),y=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),D("Keine aktuellen Koordinaten vorhanden!")});function w(a,r,t,i,c){const o=A(i,c,r,t),f=S(a).yaw;U(f,o)<15?H():g.style.color="red"}function H(){g.style.color="green"}function I(a){const{x:r,y:t,z:i,w:c}=a;let o=Math.atan2(2*(c*i+r*t),1-2*(t*t+i*i))*180/Math.PI;return o<0&&(o+=360),o}function L(a,r,t,i){const c=Math.PI/180,o=6371e3,p=i*c,f=a*c,M=r*c,O=Math.asin(Math.sin(f)*Math.cos(t/o)+Math.cos(f)*Math.sin(t/o)*Math.cos(p)),P=M+Math.atan2(Math.sin(p)*Math.sin(t/o)*Math.cos(f),Math.cos(t/o)-Math.sin(f)*Math.sin(O));return{latitude:O/c,longitude:P/c}}function q(a,r,t,i){const o=Math.PI/180,p=(t-a)*o,f=(i-r)*o,M=Math.sin(p/2)**2+Math.cos(a*o)*Math.cos(t*o)*Math.sin(f/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))}function D(a){alert(a)}function A(a,r,t,i){const c=a*Math.PI/180,o=t*Math.PI/180,p=(i-r)*Math.PI/180,f=Math.sin(p)*Math.cos(o),M=Math.cos(c)*Math.sin(o)-Math.sin(c)*Math.cos(o)*Math.cos(p);return(Math.atan2(f,M)*180/Math.PI+360)%360}function S(a){const r=a.x,t=a.y,i=a.z,c=a.w,o=2*(c*r+t*i),p=1-2*(r*r+t*t),f=Math.atan2(o,p),M=2*(c*t-i*r);let O;Math.abs(M)>=1?O=Math.sign(M)*Math.PI/2:O=Math.asin(M);const P=2*(c*i+r*t),j=1-2*(t*t+i*i);let C=Math.atan2(P,j)*180/Math.PI;return C<0&&(C+=360),{roll:f*180/Math.PI,pitch:O*180/Math.PI,yaw:C}}function U(a,r){let t=Math.abs(a-r)%360;return t>180&&(t=360-t),t}};
