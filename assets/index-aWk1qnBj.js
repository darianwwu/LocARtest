(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))y(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const M of c.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();window.onload=()=>{let b=!1;const u={latitude:51.935175,longitude:7.649708},s={latitude:null,longitude:null},y=[3,6,12],r=document.querySelector("a-scene"),c=document.querySelector("[gps-new-camera]");c.setAttribute("camera",{far:100});const M=document.createElement("div");M.id="distanceDisplay",document.body.appendChild(M);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const m=document.createElement("div");m.id="compassArrow",m.innerText="↑",w.appendChild(m);const A=document.createElement("div");A.id="compassText",w.appendChild(A);let g;if("AbsoluteOrientationSensor"in window)g=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)g=new RelativeOrientationSensor({frequency:60});else{P("Gerät unterstützt keine Orientation Sensoren.");return}g.addEventListener("reading",()=>{[...g.quaternion],E(g.quaternion),s.latitude&&s.longitude&&(console.log("Nutzerstandort:"+s.latitude+" "+s.longitude),z(g.quaternion,s.latitude,s.longitude,u.latitude,u.longitude))}),g.addEventListener("error",t=>{console.error("Sensor error: ",t.error),P("Fehler beim Sensor!")}),g.start(),c.addEventListener("gps-camera-update-position",t=>{if(s.latitude=t.detail.position.latitude,s.longitude=t.detail.position.longitude,s.latitude&&s.longitude){const i=x(s.latitude,s.longitude,u.latitude,u.longitude);M.innerText=`Entfernung zum Ziel: ${Math.round(i)} m`;let o=0;if(document.querySelectorAll("a-triangle").forEach(n=>n.remove()),y.forEach(n=>{const a=document.createElement("a-triangle");a.setAttribute("color","#00008B"),a.setAttribute("opacity","0.7");const e=C(s.latitude,s.longitude,u.latitude,u.longitude,n,o);a.setAttribute("gps-new-entity-place",{latitude:e.latitude,longitude:e.longitude}),a.setAttribute("look-at","[gps-new-camera]"),r.appendChild(a)}),!b){const n=document.createElement("a-image");n.setAttribute("src","./images/map-marker.png"),n.setAttribute("width","4"),n.setAttribute("height","4"),n.setAttribute("look-at","[gps-new-camera]"),n.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),r.appendChild(n),b=!0}}else console.error("Keine aktuellen Koordinaten vorhanden!"),P("Keine aktuellen Koordinaten vorhanden!")});function E(t){if(!t)return;const i=L(t);m.style.transform=`rotate(${-i}deg)`,A.innerText=`${Math.round(i)}°`}function L(t){let[i,o,n,a]=t,e=Math.atan2(2*(a*n+i*o),1-2*(o*o+n*n))*180/Math.PI;return e<0&&(e+=360),e}function C(t,i,o,n,a,e){const d=I(t,i,o,n,a),l=d.latitude-t,h=d.longitude-i,p=l*Math.cos(e)-h*Math.sin(e),f=l*Math.sin(e)+h*Math.cos(e);return{latitude:t+p,longitude:i+f}}function I(t,i,o,n,a){const e=Math.PI/180,d=(n-i)*e,l=Math.sin(d)*Math.cos(o*e),h=Math.cos(t*e)*Math.sin(o*e)-Math.sin(t*e)*Math.cos(o*e)*Math.cos(d),p=Math.atan2(l,h),f=6371e3,v=Math.asin(Math.sin(t*e)*Math.cos(a/f)+Math.cos(t*e)*Math.sin(a/f)*Math.cos(p)),K=i*e+Math.atan2(Math.sin(p)*Math.sin(a/f)*Math.cos(t*e),Math.cos(a/f)-Math.sin(t*e)*Math.sin(v));return{latitude:v/e,longitude:K/e}}function x(t,i,o,n){const e=Math.PI/180,d=(o-t)*e,l=(n-i)*e,h=Math.sin(d/2)**2+Math.cos(t*e)*Math.cos(o*e)*Math.sin(l/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function P(t){alert(t)}function O(t,i,o,n){const a=t*Math.PI/180,e=o*Math.PI/180,d=(n-i)*Math.PI/180,l=Math.sin(d)*Math.cos(e),h=Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(d);let p=Math.atan2(l,h);return p=p*180/Math.PI,(p+360)%360}function S(t){const i=2*(t.w*t.x+t.y*t.z),o=1-2*(t.x*t.x+t.y*t.y),n=Math.atan2(i,o),a=2*(t.w*t.y-t.z*t.x);let e;Math.abs(a)>=1?e=Math.sign(a)*Math.PI/2:e=Math.asin(a);const d=2*(t.w*t.z+t.x*t.y),l=1-2*(t.y*t.y+t.z*t.z),h=Math.atan2(d,l);return{roll:n*180/Math.PI,pitch:e*180/Math.PI,yaw:h*180/Math.PI}}function T(t,i){let o=Math.abs(t-i)%360;return o>180&&(o=360-o),o}function z(t,i,o,n,a){const e=O(i,o,n,a),l=S(t).yaw;T(l,e)<10?k():m.style.color="red"}function k(){console.log("Ziel ausgerichtet!"),m.style.color="green"}};
