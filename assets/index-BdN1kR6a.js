(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&u(p)}).observe(document,{childList:!0,subtree:!0});function M(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function u(a){if(a.ep)return;a.ep=!0;const c=M(a);fetch(a.href,c)}})();window.onload=()=>{let I=!1,l=null,M=null;const u={latitude:51.936389,longitude:7.650431},a=[3,6,9,12],c=document.querySelector("a-scene"),p=document.querySelector("[gps-new-camera]");p.setAttribute("far","1000");const L=document.createElement("div");L.id="distanceDisplay",document.body.appendChild(L);const f=document.createElement("div");f.id="compassContainer",document.body.appendChild(f);const b=document.createElement("div");b.id="compassArrow",b.innerText="↑",f.appendChild(b);const S=document.createElement("div");S.id="compassText",f.appendChild(S);const y=document.createElement("button");y.innerText="Kalibrieren",y.classList.add("calib-button"),document.body.appendChild(y),y.addEventListener("click",()=>{M?(l=[...M],P("Kalibrierung gesetzt!")):P("Keine Sensordaten für Kalibrierung verfügbar!")});let m;if("AbsoluteOrientationSensor"in window)m=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)m=new RelativeOrientationSensor({frequency:60});else{P("Gerät unterstützt keine Orientation Sensoren.");return}m.addEventListener("reading",()=>{M=[...m.quaternion],T(m.quaternion)}),m.addEventListener("error",e=>{console.error("Sensor error: ",e.error),P("Fehler beim Sensor!")}),m.start();function x(e,o,r,d){const i=Math.PI/180,n=Math.sin((d-o)*i)*Math.cos(r*i),t=Math.cos(e*i)*Math.sin(r*i)-Math.sin(e*i)*Math.cos(r*i)*Math.cos((d-o)*i);return(Math.atan2(n,t)*(180/Math.PI)+360)%360}p.addEventListener("gps-camera-update-position",e=>{const o=e.detail.position.latitude,r=e.detail.position.longitude,d=R(o,r,u.latitude,u.longitude);L.innerText=`Entfernung zum Ziel: ${Math.round(d)} m`;let i=0;l&&(i=w(M)-w(l));const n=x(o,r,u.latitude,u.longitude);if(document.querySelectorAll("a-triangle").forEach(t=>t.remove()),a.forEach(t=>{const s=document.createElement("a-triangle");s.setAttribute("color","#00008B"),s.setAttribute("opacity","0.7");const h=D(o,r,u.latitude,u.longitude,t,i);s.setAttribute("gps-new-entity-place",{latitude:h.latitude,longitude:h.longitude}),s.setAttribute("rotation",`0 ${n} 0`),c.appendChild(s)}),!I){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude}),c.appendChild(t),I=!0}});function T(e){if(!e)return;const o=w(e);b.style.transform=`rotate(${-o}deg)`,S.innerText=`${Math.round(o)}°`}function w(e){let[o,r,d,i]=e,t=Math.atan2(2*(i*d+o*r),1-2*(r*r+d*d))*180/Math.PI;return t<0&&(t+=360),l?(t-w(l)+360)%360:t}function D(e,o,r,d,i,n){const t=K(e,o,r,d,i),s=111320,h=40075e3*Math.cos(e*Math.PI/180)/360,g=(t.latitude-e)*s,E=(t.longitude-o)*h,O=E*Math.cos(n)-g*Math.sin(n),A=E*Math.sin(n)+g*Math.cos(n);return{latitude:e+A/s,longitude:o+O/h}}function K(e,o,r,d,i){const n=e*Math.PI/180,t=o*Math.PI/180,s=r*Math.PI/180,g=d*Math.PI/180-t,E=Math.sin(g)*Math.cos(s),O=Math.cos(n)*Math.sin(s)-Math.sin(n)*Math.cos(s)*Math.cos(g),A=Math.atan2(E,O),C=6371e3,v=i,q=Math.asin(Math.sin(n)*Math.cos(v/C)+Math.cos(n)*Math.sin(v/C)*Math.cos(A)),z=t+Math.atan2(Math.sin(A)*Math.sin(v/C)*Math.cos(n),Math.cos(v/C)-Math.sin(n)*Math.sin(q));return{latitude:q*180/Math.PI,longitude:z*180/Math.PI}}function R(e,o,r,d){const n=Math.PI/180,t=(r-e)*n,s=(d-o)*n,h=Math.sin(t/2)**2+Math.cos(e*n)*Math.cos(r*n)*Math.sin(s/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function P(e){alert(e)}};
