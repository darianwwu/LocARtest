(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function d(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function c(t){if(t.ep)return;t.ep=!0;const e=d(t);fetch(t.href,e)}})();window.onload=()=>{let g=!1;const n={latitude:51.934548,longitude:7.653734},d=[3,6,12],c=document.querySelector("a-scene"),t=document.querySelector("[gps-new-camera]");t.setAttribute("camera",{far:100,fov:90,near:1});const e=document.createElement("div");e.id="distanceDisplay",document.body.appendChild(e);const i=document.createElement("div");i.id="compassContainer",document.body.appendChild(i);const r=document.createElement("div");r.id="compassArrow",r.innerText="↑",i.appendChild(r);const f=document.createElement("div");f.id="compassText",i.appendChild(f),t.addEventListener("gps-camera-update-position",u=>{const l=u.detail.position.latitude,a=u.detail.position.longitude;console.log("Aktualisierte Nutzerposition");const s=b(l,a,n.latitude,n.longitude);console.log("Entfernung zum Ziel:",s),e.innerText=`Entfernung zum Ziel: ${Math.round(s)} m`;const p=A(l,a,n.latitude,n.longitude);if(console.log("Berechneter Zielwinkel:",p),y(p),!g){console.log("Füge Marker am Ziel hinzu...");const o=document.createElement("a-image");o.setAttribute("src","./images/map-marker.png"),o.setAttribute("width","4"),o.setAttribute("height","4"),o.setAttribute("gps-new-entity-place",{latitude:n.latitude,longitude:n.longitude}),c.appendChild(o),g=!0}document.querySelectorAll("a-triangle").forEach(o=>o.remove()),console.log("Alte Dreiecke entfernt."),d.forEach(o=>{const h=w(l,a,n.latitude,n.longitude,o);if(console.log(`Dreieck bei Distanz ${o}m:`,h),!h||!h.latitude||!h.longitude){console.error("Fehler: Berechnete GPS-Koordinaten sind ungültig.",h);return}const m=document.createElement("a-triangle");m.setAttribute("color","#00008B"),m.setAttribute("opacity","0.7"),m.setAttribute("gps-new-entity-place",{latitude:h.latitude,longitude:h.longitude});const M=`${n.latitude} ${n.longitude}`;console.log("Setze look-at für Dreieck auf:",M),m.setAttribute("look-at",M),c.appendChild(m)})});function y(u){window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",l=>{const a=l.alpha;if(a!==null){r.style.transform=`rotate(${-a}deg)`,f.innerText=`${Math.round(a)}°`;const s=Math.abs(a-u);s<=10||s>=350?r.style.color="green":r.style.color="white"}})}function b(u,l,a,s){const o=Math.PI/180,h=(a-u)*o,m=(s-l)*o,M=Math.sin(h/2)**2+Math.cos(u*o)*Math.cos(a*o)*Math.sin(m/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))}};function A(g,n,d,c){const t=Math.PI/180,e=Math.sin((c-n)*t)*Math.cos(d*t),i=Math.cos(g*t)*Math.sin(d*t)-Math.sin(g*t)*Math.cos(d*t)*Math.cos((c-n)*t);return(Math.atan2(e,i)*(180/Math.PI)+360)%360}function w(g,n,d,c,t){const e=g*Math.PI/180,i=n*Math.PI/180,r=d*Math.PI/180,y=c*Math.PI/180-i,b=Math.sin(y)*Math.cos(r),u=Math.cos(e)*Math.sin(r)-Math.sin(e)*Math.cos(r)*Math.cos(y),l=Math.atan2(b,u),a=6371e3,s=t,p=Math.asin(Math.sin(e)*Math.cos(s/a)+Math.cos(e)*Math.sin(s/a)*Math.cos(l)),o=i+Math.atan2(Math.sin(l)*Math.sin(s/a)*Math.cos(e),Math.cos(s/a)-Math.sin(e)*Math.sin(p));return{latitude:p*180/Math.PI,longitude:o*180/Math.PI}}
