(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function m(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=m(o);fetch(o.href,i)}})();window.onload=()=>{let L=!1,d=null,m=null;const l={latitude:51.935175,longitude:7.649708},o=[3,6,9,12],i=document.querySelector("a-scene"),g=document.querySelector("[gps-new-camera]"),I=document.createElement("div");I.id="distanceDisplay",document.body.appendChild(I);const M=document.createElement("div");M.id="compassContainer",document.body.appendChild(M);const y=document.createElement("div");y.id="compassArrow",y.innerText="↑",M.appendChild(y);const S=document.createElement("div");S.id="compassText",M.appendChild(S);const b=document.createElement("button");b.innerText="Kalibrieren",b.classList.add("calib-button"),document.body.appendChild(b),b.addEventListener("click",()=>{m?(d=[...m],E("Kalibrierung gesetzt!")):E("Keine Sensordaten für Kalibrierung verfügbar!")});let h;if("AbsoluteOrientationSensor"in window)h=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)h=new RelativeOrientationSensor({frequency:60});else{E("Gerät unterstützt keine Orientation Sensoren.");return}h.addEventListener("reading",()=>{m=[...h.quaternion],q(h.quaternion)}),h.addEventListener("error",e=>{console.error("Sensor error: ",e.error),E("Fehler beim Sensor!")}),h.start(),g.addEventListener("gps-camera-update-position",e=>{const r=e.detail.position.latitude,a=e.detail.position.longitude,c=K(r,a,l.latitude,l.longitude);I.innerText=`Entfernung zum Ziel: ${Math.round(c)} m`;let u=0;if(d&&(u=w(m)-w(d)),document.querySelectorAll("a-circle").forEach(t=>t.remove()),o.forEach(t=>{const n=document.createElement("a-circle");n.setAttribute("radius","0.5"),n.setAttribute("color","#00008B"),n.setAttribute("opacity","0.7");const s=T(r,a,l.latitude,l.longitude,t,u);n.setAttribute("gps-new-entity-place",{latitude:s.latitude,longitude:s.longitude}),console.log("neuer Kreis mit Entfernung von "+t+" m an Koordinaten "+s.latitude+", "+s.longitude+" hinzugefügt"),console.log("Nutzerkoordinaten: "+r+", "+a),i.appendChild(n)}),!L){const t=document.createElement("a-image");t.setAttribute("src","./images/map-marker.png"),t.setAttribute("width","4"),t.setAttribute("height","4"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("gps-new-entity-place",{latitude:l.latitude,longitude:l.longitude}),i.appendChild(t),L=!0}});function q(e){if(!e)return;const r=w(e);y.style.transform=`rotate(${-r}deg)`,S.innerText=`${Math.round(r)}°`}function w(e){let[r,a,c,u]=e,n=Math.atan2(2*(u*c+r*a),1-2*(a*a+c*c))*180/Math.PI;return n<0&&(n+=360),d?(n-w(d)+360)%360:n}function T(e,r,a,c,u,t){const n=F(e,r,a,c,u),s=111320,p=40075e3*Math.cos(e*Math.PI/180)/360,f=(n.latitude-e)*s,v=(n.longitude-r)*p,O=v*Math.cos(t)-f*Math.sin(t),C=v*Math.sin(t)+f*Math.cos(t);return{latitude:parseFloat((e+C/s).toFixed(6)),longitude:parseFloat((r+O/p).toFixed(6))}}function F(e,r,a,c,u){const t=e*Math.PI/180,n=r*Math.PI/180,s=a*Math.PI/180,f=c*Math.PI/180-n,v=Math.sin(f)*Math.cos(s),O=Math.cos(t)*Math.sin(s)-Math.sin(t)*Math.cos(s)*Math.cos(f),C=Math.atan2(v,O),P=6371e3,A=u,x=Math.asin(Math.sin(t)*Math.cos(A/P)+Math.cos(t)*Math.sin(A/P)*Math.cos(C)),z=n+Math.atan2(Math.sin(C)*Math.sin(A/P)*Math.cos(t),Math.cos(A/P)-Math.sin(t)*Math.sin(x));return{latitude:x*180/Math.PI,longitude:z*180/Math.PI}}function K(e,r,a,c){const t=Math.PI/180,n=(a-e)*t,s=(c-r)*t,p=Math.sin(n/2)**2+Math.cos(e*t)*Math.cos(a*t)*Math.sin(s/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function E(e){alert(e)}};
