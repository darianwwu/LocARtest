(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();window.onload=()=>{let s=!1,n=!1,r={alpha:null,beta:null,gamma:null},i=null;const e=document.createElement("div");e.id="distanceDisplay",document.body.appendChild(e);const t=document.createElement("div");t.id="compassContainer",document.body.appendChild(t);const a=document.createElement("div");a.id="compassArrow",a.innerText="↑",t.appendChild(a);const c=document.createElement("div");c.id="compassText",t.appendChild(c),window.addEventListener("deviceorientation",o=>{if(o.alpha!==null)if(n=!0,r.alpha=o.alpha,r.beta=o.beta,r.gamma=o.gamma,i!==null){let m=(o.alpha*Math.PI/180-i)*180/Math.PI;m<0&&(m+=360),a.style.transform=`rotate(${-m}deg)`,c.innerText=`${Math.round(m)}°`}else a.style.transform=`rotate(${-o.alpha}deg)`,c.innerText=`${Math.round(o.alpha)}°`});const h=document.createElement("button");h.id="calibButton",h.innerText="Kalibrieren",document.body.appendChild(h),h.addEventListener("click",()=>{if(n&&r.alpha!==null){i=r.alpha*Math.PI/180,y("Kalibrierung gesetzt!"),console.log("Kalibrierter Heading (in Radianten):",i);let d=(r.alpha*Math.PI/180-i)*180/Math.PI;d<0&&(d+=360),a.style.transform=`rotate(${-d}deg)`,c.innerText=`${Math.round(d)}°`}else y("Keine Sensordaten für Kalibrierung verfügbar!")});const l={latitude:51.935169,longitude:7.64971},p=[3,6,9,12,15],M=document.querySelector("a-scene");document.querySelector("[gps-new-camera]").addEventListener("gps-camera-update-position",o=>{if(!n){console.log("Warte auf vollständige Sensordaten...");return}const d=o.detail.position.latitude,m=o.detail.position.longitude;y("GPS-Position aktualisiert");const b=w(d,m,l.latitude,l.longitude);e.innerText=`Entfernung zum Ziel: ${Math.round(b)} m`;let P=0;if(i!==null&&(P=r.alpha*Math.PI/180-i),document.querySelectorAll("a-circle").forEach(u=>u.parentNode.removeChild(u)),p.forEach(u=>{const f=document.createElement("a-circle");f.setAttribute("radius","0.5"),f.setAttribute("color","#00008B"),f.setAttribute("opacity","0.7");const C=I(d,m,l.latitude,l.longitude,u,P);f.setAttribute("gps-new-entity-place",{latitude:C.latitude,longitude:C.longitude}),M.appendChild(f)}),!s){const u=document.createElement("a-image");u.setAttribute("src","./images/map-marker.png"),u.setAttribute("width","4"),u.setAttribute("height","4"),u.setAttribute("look-at","[gps-new-camera]"),u.setAttribute("gps-new-entity-place",{latitude:l.latitude,longitude:l.longitude}),M.appendChild(u),s=!0}})};function E(s,n,r,i,e){const t=s*Math.PI/180,a=n*Math.PI/180,c=r*Math.PI/180,l=i*Math.PI/180-a,p=Math.sin(l)*Math.cos(c),M=Math.cos(t)*Math.sin(c)-Math.sin(t)*Math.cos(c)*Math.cos(l),g=Math.atan2(p,M),o=6371e3,d=e,m=Math.asin(Math.sin(t)*Math.cos(d/o)+Math.cos(t)*Math.sin(d/o)*Math.cos(g)),b=a+Math.atan2(Math.sin(g)*Math.sin(d/o)*Math.cos(t),Math.cos(d/o)-Math.sin(t)*Math.sin(m));return{latitude:m*180/Math.PI,longitude:b*180/Math.PI}}function I(s,n,r,i,e,t){const a=E(s,n,r,i,e),c=111320,h=40075e3*Math.cos(s*Math.PI/180)/360,l=(a.latitude-s)*c,p=(a.longitude-n)*h,M=p*Math.cos(t)-l*Math.sin(t),g=p*Math.sin(t)+l*Math.cos(t),o=s+g/c,d=n+M/h;return{latitude:o,longitude:d}}function w(s,n,r,i){const t=Math.PI/180,a=(r-s)*t,c=(i-n)*t,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(s*t)*Math.cos(r*t)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}function y(s){const n=document.createElement("div");n.className="toast",n.innerText=s,document.body.appendChild(n),setTimeout(()=>{n.remove()},1e3)}
