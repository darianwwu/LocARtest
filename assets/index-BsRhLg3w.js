(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function g(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(a){if(a.ep)return;a.ep=!0;const c=g(a);fetch(a.href,c)}})();window.onload=()=>{let E=!1,m=null;const g={latitude:51.935175,longitude:7.649708},r={latitude:null,longitude:null},a=[3,5.5,12],c=document.querySelector("a-scene"),f=document.querySelector("[gps-new-camera]");f.setAttribute("camera",{far:100});const P=document.createElement("div");P.id="distanceDisplay",document.body.appendChild(P);const w=document.createElement("div");w.id="compassContainer",document.body.appendChild(w);const M=document.createElement("div");M.id="compassArrow",M.innerText="↑",w.appendChild(M);const v=document.createElement("div");v.id="compassText",w.appendChild(v);let b;if("AbsoluteOrientationSensor"in window)b=new AbsoluteOrientationSensor({frequency:60});else if("RelativeOrientationSensor"in window)b=new RelativeOrientationSensor({frequency:60});else{C("Gerät unterstützt keine Orientation Sensoren.");return}b.addEventListener("reading",()=>{m=[...b.quaternion],S(m),r.latitude&&r.longitude&&(console.log("Nutzerstandort:"+r.latitude+" "+r.longitude),z(m,r.latitude,r.longitude,g.latitude,g.longitude))}),b.addEventListener("error",e=>{console.error("Sensor error: ",e.error),C("Fehler beim Sensor!")}),b.start(),f.addEventListener("gps-camera-update-position",e=>{if(r.latitude=e.detail.position.latitude,r.longitude=e.detail.position.longitude,r.latitude&&r.longitude){const i=k(r.latitude,r.longitude,g.latitude,g.longitude);P.innerText=`Entfernung zum Ziel: ${Math.round(i)} m`;let o=0;if(document.querySelectorAll("a-sphere").forEach(n=>n.remove()),a.forEach((n,s)=>{const t=document.createElement("a-sphere");t.setAttribute("color","#00008B"),t.setAttribute("opacity","0.7");const u=x(r.latitude,r.longitude,g.latitude,g.longitude,n,o);t.setAttribute("gps-new-entity-place",{latitude:u.latitude,longitude:u.longitude});let l;s===0?l=.3:s===1?l=.4:s===2&&(l=.65),t.setAttribute("radius",l.toString()),c.appendChild(t)}),!E){const n=document.createElement("a-image");n.setAttribute("src","./images/map-marker.png"),n.setAttribute("width","4"),n.setAttribute("height","4"),n.setAttribute("look-at","[gps-new-camera]"),n.setAttribute("gps-new-entity-place",{latitude:g.latitude,longitude:g.longitude}),c.appendChild(n),E=!0;const s=document.createElement("a-image");s.setAttribute("src","./images/map-marker.png"),s.setAttribute("width","8"),s.setAttribute("height","8"),s.setAttribute("look-at","[gps-new-camera]"),s.setAttribute("gps-new-entity-place",{latitude:51.935145,longitude:7.652255}),c.appendChild(s);const t=document.createElement("a-text");t.setAttribute("value","Beispieltext"),t.setAttribute("look-at","[gps-new-camera]"),t.setAttribute("align","center"),t.setAttribute("color","black"),t.setAttribute("z-offset","3"),t.setAttribute("gps-new-entity-place",{latitude:51.935145,longitude:7.652255}),c.appendChild(t),console.log("Erstelltes Element testtext:",t),console.log("Attribute testtext:",t.getAttribute("value")),console.log("GPS-Position testtext:",t.getAttribute("gps-new-entity-place")),console.log("Kinder der Szene testtext:",c.children),console.log("Erstelltes Element testmarker:",s),console.log("GPS-Position testmarker:",s.getAttribute("gps-new-entity-place")),console.log("Erstelltes Element marker:",n),console.log("GPS-Position marker:",n.getAttribute("gps-new-entity-place"))}}else console.error("Keine aktuellen Koordinaten vorhanden!"),C("Keine aktuellen Koordinaten vorhanden!")});function S(e){if(!e)return;const i=L(e);M.style.transform=`rotate(${-i}deg)`,v.innerText=`${Math.round(i)}°`}function L(e){let[i,o,n,s]=e,t=Math.atan2(2*(s*n+i*o),1-2*(o*o+n*n))*180/Math.PI;return t<0&&(t+=360),t}function x(e,i,o,n,s,t){const u=I(e,i,o,n,s),l=u.latitude-e,d=u.longitude-i,h=l*Math.cos(t)-d*Math.sin(t),p=l*Math.sin(t)+d*Math.cos(t);return{latitude:e+h,longitude:i+p}}function I(e,i,o,n,s){const t=Math.PI/180,u=(n-i)*t,l=Math.sin(u)*Math.cos(o*t),d=Math.cos(e*t)*Math.sin(o*t)-Math.sin(e*t)*Math.cos(o*t)*Math.cos(u),h=Math.atan2(l,d),p=6371e3,A=Math.asin(Math.sin(e*t)*Math.cos(s/p)+Math.cos(e*t)*Math.sin(s/p)*Math.cos(h)),y=i*t+Math.atan2(Math.sin(h)*Math.sin(s/p)*Math.cos(e*t),Math.cos(s/p)-Math.sin(e*t)*Math.sin(A));return{latitude:A/t,longitude:y/t}}function k(e,i,o,n){const t=Math.PI/180,u=(o-e)*t,l=(n-i)*t,d=Math.sin(u/2)**2+Math.cos(e*t)*Math.cos(o*t)*Math.sin(l/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function C(e){alert(e)}function O(e,i,o,n){const s=e*Math.PI/180,t=o*Math.PI/180,u=(n-i)*Math.PI/180,l=Math.sin(u)*Math.cos(t),d=Math.cos(s)*Math.sin(t)-Math.sin(s)*Math.cos(t)*Math.cos(u);let h=Math.atan2(l,d);return h=h*180/Math.PI,(h+360)%360}function q(e){const[i,o,n,s]=e,t=2*(s*i+o*n),u=1-2*(i*i+o*o),l=Math.atan2(t,u),d=2*(s*o-n*i);let h;Math.abs(d)>=1?h=Math.sign(d)*Math.PI/2:h=Math.asin(d);const p=2*(s*n+i*o),A=1-2*(o*o+n*n);let y=Math.atan2(p,A)*180/Math.PI;return y<0&&(y+=360),{roll:l*180/Math.PI,pitch:h*180/Math.PI,yaw:y}}function T(e,i){let o=Math.abs(e-i)%360;return o>180&&(o=360-o),o}function z(e,i,o,n,s){const t=O(n,s,i,o),l=q(e).yaw;T(l,t)<15?K():M.style.color="red"}function K(){console.log("Ziel ausgerichtet!"),M.style.color="green"}};
